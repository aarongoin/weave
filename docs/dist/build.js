!function e(t,n,o){function r(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){var n=t[a][1][e];return r(n?n:e)},u,u.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t,n){var o=o||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},o=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in o,i=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},a=/constructor/i.test(e.HTMLElement)||e.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent),c=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,4e4)},u=function(e,t,n){t=[].concat(t);for(var o=t.length;o--;){var r=e["on"+t[o]];if("function"==typeof r)try{r.call(e,n||e)}catch(e){c(e)}}},d=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},f=function(t,c,f){f||(t=d(t));var p,h=this,m=t.type,y="application/octet-stream"===m,v=function(){u(h,"writestart progress write writeend".split(" "))};if(h.readyState=h.INIT,r)return p=n().createObjectURL(t),void setTimeout(function(){o.href=p,o.download=c,i(o),v(),l(p),h.readyState=h.DONE});!function(){if((s||y&&a)&&e.FileReader){var o=new FileReader;return o.onloadend=function(){var t=s?o.result:o.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,h.readyState=h.DONE,v()},o.readAsDataURL(t),void(h.readyState=h.INIT)}if(p||(p=n().createObjectURL(t)),y)e.location.href=p;else{e.open(p,"_blank")||(e.location.href=p)}h.readyState=h.DONE,v(),l(p)}()},p=f.prototype,h=function(e,t,n){return new f(e,t||e.name||"download",n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=d(e)),navigator.msSaveOrOpenBlob(e,t)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,h)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);void 0!==t&&t.exports?t.exports.saveAs=o:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return o})},{}],2:[function(e,t,n){var o=function(){function e(e,t){if(!r[e]){r[e]={};for(var n=0;n<e.length;n++)r[e][e.charAt(n)]=n}return r[e][t]}var t=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={},i={compressToBase64:function(e){if(null==e)return"";var t=i._compress(e,6,function(e){return n.charAt(e)});switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:i._decompress(t.length,32,function(o){return e(n,t.charAt(o))})},compressToUTF16:function(e){return null==e?"":i._compress(e,15,function(e){return t(e+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:i._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=i.compress(e),n=new Uint8Array(2*t.length),o=0,r=t.length;o<r;o++){var a=t.charCodeAt(o);n[2*o]=a>>>8,n[2*o+1]=a%256}return n},decompressFromUint8Array:function(e){if(null===e||void 0===e)return i.decompress(e);for(var n=new Array(e.length/2),o=0,r=n.length;o<r;o++)n[o]=256*e[2*o]+e[2*o+1];var a=[];return n.forEach(function(e){a.push(t(e))}),i.decompress(a.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":i._compress(e,6,function(e){return o.charAt(e)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),i._decompress(t.length,32,function(n){return e(o,t.charAt(n))}))},compress:function(e){return i._compress(e,16,function(e){return t(e)})},_compress:function(e,t,n){if(null==e)return"";var o,r,i,a={},s={},c="",l="",u="",d=2,f=3,p=2,h=[],m=0,y=0;for(i=0;i<e.length;i+=1)if(c=e.charAt(i),Object.prototype.hasOwnProperty.call(a,c)||(a[c]=f++,s[c]=!0),l=u+c,Object.prototype.hasOwnProperty.call(a,l))u=l;else{if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(o=0;o<p;o++)m<<=1,y==t-1?(y=0,h.push(n(m)),m=0):y++;for(r=u.charCodeAt(0),o=0;o<8;o++)m=m<<1|1&r,y==t-1?(y=0,h.push(n(m)),m=0):y++,r>>=1}else{for(r=1,o=0;o<p;o++)m=m<<1|r,y==t-1?(y=0,h.push(n(m)),m=0):y++,r=0;for(r=u.charCodeAt(0),o=0;o<16;o++)m=m<<1|1&r,y==t-1?(y=0,h.push(n(m)),m=0):y++,r>>=1}d--,0==d&&(d=Math.pow(2,p),p++),delete s[u]}else for(r=a[u],o=0;o<p;o++)m=m<<1|1&r,y==t-1?(y=0,h.push(n(m)),m=0):y++,r>>=1;d--,0==d&&(d=Math.pow(2,p),p++),a[l]=f++,u=String(c)}if(""!==u){if(Object.prototype.hasOwnProperty.call(s,u)){if(u.charCodeAt(0)<256){for(o=0;o<p;o++)m<<=1,y==t-1?(y=0,h.push(n(m)),m=0):y++;for(r=u.charCodeAt(0),o=0;o<8;o++)m=m<<1|1&r,y==t-1?(y=0,h.push(n(m)),m=0):y++,r>>=1}else{for(r=1,o=0;o<p;o++)m=m<<1|r,y==t-1?(y=0,h.push(n(m)),m=0):y++,r=0;for(r=u.charCodeAt(0),o=0;o<16;o++)m=m<<1|1&r,y==t-1?(y=0,h.push(n(m)),m=0):y++,r>>=1}d--,0==d&&(d=Math.pow(2,p),p++),delete s[u]}else for(r=a[u],o=0;o<p;o++)m=m<<1|1&r,y==t-1?(y=0,h.push(n(m)),m=0):y++,r>>=1;d--,0==d&&(d=Math.pow(2,p),p++)}for(r=2,o=0;o<p;o++)m=m<<1|1&r,y==t-1?(y=0,h.push(n(m)),m=0):y++,r>>=1;for(;;){if(m<<=1,y==t-1){h.push(n(m));break}y++}return h.join("")},decompress:function(e){return null==e?"":""==e?null:i._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(e,n,o){var r,i,a,s,c,l,u,d=[],f=4,p=4,h=3,m="",y=[],v={val:o(0),position:n,index:1};for(r=0;r<3;r+=1)d[r]=r;for(a=0,c=Math.pow(2,2),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=o(v.index++)),a|=(s>0?1:0)*l,l<<=1;switch(a){case 0:for(a=0,c=Math.pow(2,8),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=o(v.index++)),a|=(s>0?1:0)*l,l<<=1;u=t(a);break;case 1:for(a=0,c=Math.pow(2,16),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=o(v.index++)),a|=(s>0?1:0)*l,l<<=1;u=t(a);break;case 2:return""}for(d[3]=u,i=u,y.push(u);;){if(v.index>e)return"";for(a=0,c=Math.pow(2,h),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=o(v.index++)),a|=(s>0?1:0)*l,l<<=1;switch(u=a){case 0:for(a=0,c=Math.pow(2,8),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=o(v.index++)),a|=(s>0?1:0)*l,l<<=1;d[p++]=t(a),u=p-1,f--;break;case 1:for(a=0,c=Math.pow(2,16),l=1;l!=c;)s=v.val&v.position,v.position>>=1,0==v.position&&(v.position=n,v.val=o(v.index++)),a|=(s>0?1:0)*l,l<<=1;d[p++]=t(a),u=p-1,f--;break;case 2:return y.join("")}if(0==f&&(f=Math.pow(2,h),h++),d[u])m=d[u];else{if(u!==p)return null;m=i+i.charAt(0)}y.push(m),d[p++]=i+m.charAt(0),f--,i=m,0==f&&(f=Math.pow(2,h),h++)}}};return i}();"function"==typeof define&&define.amd?define(function(){return o}):void 0!==t&&null!=t&&(t.exports=o)},{}],3:[function(e,t,n){!function(){"use strict";function e(){}function n(t,n){var o,r,i,a,s=z;for(a=arguments.length;a-- >2;)L.push(arguments[a]);for(n&&null!=n.children&&(L.length||L.push(n.children),delete n.children);L.length;)if((r=L.pop())&&void 0!==r.pop)for(a=r.length;a--;)L.push(r[a]);else r!==!0&&r!==!1||(r=null),(i="function"!=typeof t)&&(null==r?r="":"number"==typeof r?r=String(r):"string"!=typeof r&&(i=!1)),i&&o?s[s.length-1]+=r:s===z?s=[r]:s.push(r),o=i;var c=new e;return c.nodeName=t,c.children=s,c.attributes=null==n?void 0:n,c.key=null==n?void 0:n.key,void 0!==D.vnode&&D.vnode(c),c}function o(e,t){for(var n in t)e[n]=t[n];return e}function r(e,t){return n(e.nodeName,o(o({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}function i(e){!e.__d&&(e.__d=!0)&&1==I.push(e)&&(D.debounceRendering||setTimeout)(a)}function a(){var e,t=I;for(I=[];e=t.pop();)e.__d&&k(e)}function s(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&c(e,t.nodeName):n||e._componentConstructor===t.nodeName}function c(e,t){return e.__n===t||e.nodeName.toLowerCase()===t.toLowerCase()}function l(e){var t=o({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);return t}function u(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.__n=e,n}function d(e){e.parentNode&&e.parentNode.removeChild(e)}function f(e,t,n,o,r){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n&&n(null),o&&o(e);else if("class"!==t||r)if("style"===t){if(o&&"string"!=typeof o&&"string"!=typeof n||(e.style.cssText=o||""),o&&"object"==typeof o){if("string"!=typeof n)for(var i in n)i in o||(e.style[i]="");for(var i in o)e.style[i]="number"==typeof o[i]&&P.test(i)===!1?o[i]+"px":o[i]}}else if("dangerouslySetInnerHTML"===t)o&&(e.innerHTML=o.__html||"");else if("o"==t[0]&&"n"==t[1]){var a=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),o?n||e.addEventListener(t,h,a):e.removeEventListener(t,h,a),(e.__l||(e.__l={}))[t]=o}else if("list"!==t&&"type"!==t&&!r&&t in e)p(e,t,null==o?"":o),null!=o&&o!==!1||e.removeAttribute(t);else{var s=r&&t!==(t=t.replace(/^xlink\:?/,""));null==o||o===!1?s?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof o&&(s?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),o):e.setAttribute(t,o))}else e.className=o||""}function p(e,t,n){try{e[t]=n}catch(e){}}function h(e){return this.__l[e.type](D.event&&D.event(e)||e)}function m(){for(var e;e=R.pop();)D.afterMount&&D.afterMount(e),e.componentDidMount&&e.componentDidMount()}function y(e,t,n,o,r,i){N++||(F=null!=r&&void 0!==r.ownerSVGElement,H=null!=e&&!("__preactattr_"in e));var a=v(e,t,n,o,i);return r&&a.parentNode!==r&&r.appendChild(a),--N||(H=!1,i||m()),a}function v(e,t,n,o,r){var i=e,a=F;if(null==t&&(t=""),"string"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),b(e,!0))),i.__preactattr_=!0,i;if("function"==typeof t.nodeName)return _(e,t,n,o);if(F="svg"===t.nodeName||"foreignObject"!==t.nodeName&&F,(!e||!c(e,String(t.nodeName)))&&(i=u(String(t.nodeName),F),e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),b(e,!0)}var s=i.firstChild,l=i.__preactattr_||(i.__preactattr_={}),d=t.children;return!H&&d&&1===d.length&&"string"==typeof d[0]&&null!=s&&void 0!==s.splitText&&null==s.nextSibling?s.nodeValue!=d[0]&&(s.nodeValue=d[0]):(d&&d.length||null!=s)&&g(i,d,n,o,H||null!=l.dangerouslySetInnerHTML),x(i,t.attributes,l),F=a,i}function g(e,t,n,o,r){var i,a,c,l,u=e.childNodes,f=[],p={},h=0,m=0,y=u.length,g=0,w=t?t.length:0;if(0!==y)for(var x=0;x<y;x++){var j=u[x],S=j.__preactattr_,E=w&&S?j._component?j._component.__k:S.key:null;null!=E?(h++,p[E]=j):(S||(void 0!==j.splitText?!r||j.nodeValue.trim():r))&&(f[g++]=j)}if(0!==w)for(var x=0;x<w;x++){c=t[x],l=null;var E=c.key;if(null!=E)h&&void 0!==p[E]&&(l=p[E],p[E]=void 0,h--);else if(!l&&m<g)for(i=m;i<g;i++)if(void 0!==f[i]&&s(a=f[i],c,r)){l=a,f[i]=void 0,i===g-1&&g--,i===m&&m++;break}l=v(l,c,n,o),l&&l!==e&&(x>=y?e.appendChild(l):l!==u[x]&&(l===u[x+1]?d(u[x]):e.insertBefore(l,u[x]||null)))}if(h)for(var x in p)void 0!==p[x]&&b(p[x],!1);for(;m<=g;)void 0!==(l=f[g--])&&b(l,!1)}function b(e,t){var n=e._component;n?O(n):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),t!==!1&&null!=e.__preactattr_||d(e),w(e))}function w(e){for(e=e.lastChild;e;){var t=e.previousSibling;b(e,!0),e=t}}function x(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||f(e,o,n[o],n[o]=void 0,F);for(o in t)"children"===o||"innerHTML"===o||o in n&&t[o]===("value"===o||"checked"===o?e[o]:n[o])||f(e,o,n[o],n[o]=t[o],F)}function j(e){var t=e.constructor.name;(V[t]||(V[t]=[])).push(e)}function S(e,t,n){var o,r=V[e.name];if(e.prototype&&e.prototype.render?(o=new e(t,n),M.call(o,t,n)):(o=new M(t,n),o.constructor=e,o.render=E),r)for(var i=r.length;i--;)if(r[i].constructor===e){o.__b=r[i].__b,r.splice(i,1);break}return o}function E(e,t,n){return this.constructor(e,n)}function C(e,t,n,o,r){e.__x||(e.__x=!0,(e.__r=t.ref)&&delete t.ref,(e.__k=t.key)&&delete t.key,!e.base||r?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,o),o&&o!==e.context&&(e.__c||(e.__c=e.context),e.context=o),e.__p||(e.__p=e.props),e.props=t,e.__x=!1,0!==n&&(1!==n&&D.syncComponentUpdates===!1&&e.base?i(e):k(e,1,r)),e.__r&&e.__r(e))}function k(e,t,n,r){if(!e.__x){var i,a,s,c=e.props,u=e.state,d=e.context,f=e.__p||c,p=e.__s||u,h=e.__c||d,v=e.base,g=e.__b,w=v||g,x=e._component,j=!1;if(v&&(e.props=f,e.state=p,e.context=h,2!==t&&e.shouldComponentUpdate&&e.shouldComponentUpdate(c,u,d)===!1?j=!0:e.componentWillUpdate&&e.componentWillUpdate(c,u,d),e.props=c,e.state=u,e.context=d),e.__p=e.__s=e.__c=e.__b=null,e.__d=!1,!j){i=e.render(c,u,d),e.getChildContext&&(d=o(o({},d),e.getChildContext()));var E,_,M=i&&i.nodeName;if("function"==typeof M){var T=l(i);a=x,a&&a.constructor===M&&T.key==a.__k?C(a,T,1,d,!1):(E=a,e._component=a=S(M,T,d),a.__b=a.__b||g,a.__u=e,C(a,T,0,d,!1),k(a,1,n,!0)),_=a.base}else s=w,E=x,E&&(s=e._component=null),(w||1===t)&&(s&&(s._component=null),_=y(s,i,d,n||!v,w&&w.parentNode,!0));if(w&&_!==w&&a!==x){var L=w.parentNode;L&&_!==L&&(L.replaceChild(_,w),E||(w._component=null,b(w,!1)))}if(E&&O(E),e.base=_,_&&!r){for(var z=e,P=e;P=P.__u;)(z=P).base=_;_._component=z,_._componentConstructor=z.constructor}}if(!v||n?R.unshift(e):j||(m(),e.componentDidUpdate&&e.componentDidUpdate(f,p,h),D.afterUpdate&&D.afterUpdate(e)),null!=e.__h)for(;e.__h.length;)e.__h.pop().call(e);N||r||m()}}function _(e,t,n,o){for(var r=e&&e._component,i=r,a=e,s=r&&e._componentConstructor===t.nodeName,c=s,u=l(t);r&&!c&&(r=r.__u);)c=r.constructor===t.nodeName;return r&&c&&(!o||r._component)?(C(r,u,3,n,o),e=r.base):(i&&!s&&(O(i),e=a=null),r=S(t.nodeName,u,n),e&&!r.__b&&(r.__b=e,a=null),C(r,u,1,n,o),e=r.base,a&&e!==a&&(a._component=null,b(a,!1))),e}function O(e){D.beforeUnmount&&D.beforeUnmount(e);var t=e.base;e.__x=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?O(n):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),e.__b=t,d(t),j(e),w(t)),e.__r&&e.__r(null)}function M(e,t){this.__d=!0,this.context=t,this.props=e,this.state=this.state||{}}function T(e,t,n){return y(n,e,{},!1,t,!1)}var D={},L=[],z=[],P=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,I=[],R=[],N=0,F=!1,H=!1,V={};o(M.prototype,{setState:function(e,t){var n=this.state;this.__s||(this.__s=o({},n)),o(n,"function"==typeof e?e(n,this.props):e),t&&(this.__h=this.__h||[]).push(t),i(this)},forceUpdate:function(e){e&&(this.__h=this.__h||[]).push(e),k(this,2)},render:function(){},cueRender:function(){i(this)}});var B={h:n,createElement:n,cloneElement:r,Component:M,render:T,rerender:a,options:D};void 0!==t?t.exports=B:self.preact=B}()},{}],4:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();e("./polyfills.js");var s=e("preact"),c=e("file-saver"),l=e("./components/WeaveView.js"),u=e("./components/ProjectSidebar.js"),d=e("./components/NoteSidebar.js"),f=(e("./colors.js"),e("./MapModel.js")),p=e("./bind.js"),h=e("./Sourcery.js"),m=e("./actions.js"),y={app:{position:"relative",display:"flex",justifyContent:"center",alignItems:"flex-start",minWidth:"100vw",height:"100vh"}},v=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.focus="",i.state={modalView:0,project:h.getLocal("weave-project"),sceneMap:{},noteMap:[],fontSize:13,sidebarTab:0,sidebarToggled:!0,notesToggled:!0},Object.assign(i.state,JSON.parse(h.getLocal("weave-appstate")||"{}")),i.state.project?i.state.project=JSON.parse(i.state.project):(i.state.project={},m.CreateProject({},i.state.project)),p(i),i.Map(),i}return i(t,e),a(t,[{key:"countProject",value:function(){return{w:this.state.project.s.reduce(function(e,t){return e+t.s.reduce(function(e,t){return t?e+t.w:e},0)},0),c:this.state.project.s.reduce(function(e,t){return e+t.s.reduce(function(e,t){return t?e+1:e},0)},0)}}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.onResize),window.addEventListener("keydown",this.onKeyDown)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResize),window.removeEventListener("keydown",this.onKeyDown)}},{key:"componentDidUpdate",value:function(){h.setLocal("weave-appstate",JSON.stringify({fontSize:this.state.fontSize,sidebarTab:this.state.sidebarTab,sidebarToggled:this.state.sidebarToggled,notesToggled:this.state.notesToggled}))}},{key:"render",value:function(e,t,n){var o=this;return s.createElement("div",{id:"app",style:t.modalView?Object.assign({overflow:"hidden"},y.app):y.app},s.createElement(u,{toggled:t.sidebarToggled,project:t.project,scenes:t.sceneMap.sceneCount,notes:t.noteMap.length,tab:t.sidebarTab,onTab:function(e){return o.setState({sidebarTab:e})},print:this.print}),s.createElement(l,{thread:t.project.thread,map:t.sceneMap,sceneCount:t.sceneMap.sceneCount}),s.createElement(d,{toggled:t.notesToggled,notes:t.noteMap}))}},{key:"onResize",value:function(){this.cueRender()}},{key:"onKeyDown",value:function(e){e.metaKey!==!0&&e.ctrlKey!==!0||(89===e.keyCode||90===e.keyCode&&(e.preventDefault(),e.shiftKey===!0?this.Redo():this.Undo()),66===e.keyCode&&(e.preventDefault(),this.setState({sidebarToggled:!this.state.sidebarToggled})),75===e.keyCode&&(e.preventDefault(),this.setState({notesToggled:!this.state.notesToggled})),70===e.keyCode&&(e.preventDefault(),this.setState({sidebarTab:2,sidebarToggled:!0}),window.document.getElementById("searchBar").focus()),187===e.keyCode&&(e.preventDefault(),window.document.firstElementChild.style.fontSize=Number(++this.state.fontSize).toString()+"px",this.cueRender()),189===e.keyCode&&(e.preventDefault(),window.document.firstElementChild.style.fontSize=Number(--this.state.fontSize).toString()+"px",this.cueRender()))}},{key:"Do",value:function(e,t){this.focus=m.Do(e,t,this.state.project),this.Map(),this.save(),"ModifyChapters"===e&&this.cueRender(),(e.startsWith("New")||e.startsWith("Create"))&&this.cueRender()}},{key:"Undo",value:function(){m.Undo(this.state.project),this.Map(),this.save()}},{key:"Redo",value:function(){m.Redo(this.state.project),this.Map(),this.save()}},{key:"Map",value:function(){this.setState({sceneMap:f.Scenes(this.state.project.scene,this.state.project.location,this.state.project.visible,this.state.project.search,this.state.project,this.Get),noteMap:f.Notes(this.state.project.note,this.state.project.visible,this.state.project.search,this.Get)})}},{key:"Get",value:function(e){switch(e.charAt(0)){case"s":return this.state.project.scene[e];case"l":return this.state.project.location[e];case"t":return this.state.project.thread[e];case"n":return this.state.project.note[e];case"f":return this.state.project.folder[e];default:return null}}},{key:"openProject",value:function(e){e=JSON.parse(e),this.setState(Object.assign(e)),this.Map(),this.save()}},{key:"save",value:function(){h.setLocal("weave-project",JSON.stringify(this.state.project))}},{key:"doesTimeConflict",value:function(e,t,n){var o=this.state.project.scene;for(var r in o)if(o[r].location===e&&r!==n&&o[r].utctime===t)return!0;return!1}},{key:"eatFocus",value:function(){this.focus=void 0}},{key:"focusOn",value:function(e){this.focus=e,this.cueRender()}},{key:"getChildContext",value:function(){return{Get:this.Get,Do:this.Do,doesTimeConflict:this.doesTimeConflict,focus:this.focus,focusOn:this.focusOn,eatFocus:this.eatFocus,fontSize:this.state.fontSize}}},{key:"print",value:function(){var e,t,n=this.state.project.printSettings,o=this.state.project.meta,r="",i=-1;r+="\n\n\n"+o.title+"\n\n",o.author.length>0&&(r+="by: "+o.author),r+="\n\n\n\n";var a=!0,s=!1,l=void 0;try{for(var u,d=this.state.project.chapters[Symbol.iterator]();!(a=(u=d.next()).done);a=!0){var f=u.value;r+="Chapter "+ ++i+". "+f.title+"\n\n\n";var p=!0,h=!1,m=void 0;try{for(var y,v=f.scenes[Symbol.iterator]();!(p=(y=v.next()).done);p=!0){var g=y.value;if(e=this.Get(g),n.location&&(r+=this.Get(e.location).name),n.date&&(r+=" - "+e.time+"\n\n"),n.threads){t=Object.keys(e.thread);var b=!0,w=!1,x=void 0;try{for(var j,S=t[Symbol.iterator]();!(b=(j=S.next()).done);b=!0){var E=j.value;r+=this.Get(E).name+"  "}}catch(e){w=!0,x=e}finally{try{!b&&S.return&&S.return()}finally{if(w)throw x}}r+=e.thread+"\n\n"}n.summary&&(r+=e.summary+"\n\n"),n.body&&(r+="*\n\n",r+=e.body+"\n\n"),r+="* * *\n\n"}}catch(e){h=!0,m=e}finally{try{!p&&v.return&&v.return()}finally{if(h)throw m}}r+="\n\n\n"}}catch(e){s=!0,l=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw l}}c.saveAs(new Blob([r],{type:"text/plain;charset=utf-8"}),this.state.project.meta.title+"_"+(new Date).toString()+".txt")}}]),t}(s.Component);s.options.debounceRendering=window.requestAnimationFrame,s.render(s.createElement(v,null),document.body)},{"./MapModel.js":5,"./Sourcery.js":6,"./actions.js":7,"./bind.js":8,"./colors.js":10,"./components/NoteSidebar.js":21,"./components/ProjectSidebar.js":23,"./components/WeaveView.js":30,"./polyfills.js":31,"file-saver":1,preact:3}],5:[function(e,t,n){"use strict";function o(e){var t,n={times:{},offset:3},o=Object.keys(e).sort(),r=e[o[0]],i=0;for(n.times[o[0]]=5;++i<o.length;)t=e[o[i]],n.offset+=Math.min(Math.max(Math.sqrt(t-r)/64,0),120)+6.5,n.times[o[i]]=n.offset,r=t;return n.newest=r,n}var r={Scenes:function(e,t,n,r,i,a){var s,c,l,u,d,f={scenes:{},times:{},threads:{},sceneCount:0},r=r.toLowerCase();for(var p in i.locationList)n[i.locationList[p]]&&(f.scenes[i.locationList[p]]=[]);for(var h in i.locationFolders)i.folder[i.locationFolders[h]].items.forEach(function(e){n[e]&&(f.scenes[e]=[])});s=Object.keys(f.scenes),Object.keys(e).map(function(t){var o,i=e[t],c=Object.keys(i.thread),l=!1,u=-1,d=!1;if(n[i.location]){if(c.length)for(;++u<c.length;)n[c[u]]&&(o=f.threads[c[u]]=f.threads[c[u]]||[],o.push([s.indexOf(i.location),i.utctime,1.5*u]),(""===r||a(c[u]).name.toLowerCase().includes(r))&&(d=!0),l=!0);else l=!0;l&&(""===r||d||i.summary.toLowerCase().includes(r)||i.body.toLowerCase().includes(r)||i.time.toLowerCase().includes(r))&&(f.times[i.utctime]=f.times[i.utctime]||Date.parse(i.utctime)/6e4,f.scenes[i.location].push(i),f.sceneCount++)}});for(var m in f.threads){if(c=Object.keys(i.thread[m].time),c.sort(function(e,t){return Date.parse(e)>Date.parse(t)}),l=f.threads[m],l.sort(function(e,t){return Date.parse(e[1])>Date.parse(t[1])}),p=l.length,d=[],u=[],1===p)f.threads[m]=[["normal",l]];else for(;p--;)p>0&&(c.indexOf(l[p][1])-c.indexOf(l[p-1][1])==1?(u[0]!==l[p]&&u.unshift(l[p]),u.unshift(l[p-1])):(u.unshift("normal"),d.unshift(u),u=[],d.unshift(["dashed",l[p-1],l[p]])));u.length&&(u.unshift("normal"),d.unshift(u)),f.threads[m]=d}for(var y in f.scenes)f.scenes[y].sort(function(e,t){return Date.parse(e.utctime)>Date.parse(t.utctime)});return Object.assign(f,o(f.times))},Notes:function(e,t,n,o){var r=[];return Object.keys(e).map(function(i){var a=e[i],s=-1,c=!1;for(s in a.tag){if(!t[s])return;(""===n||o(s).name.toLowerCase().includes(n))&&(c=!0)}(""===n||c||a.body.toLowerCase().includes(n))&&r.push(a)}),r}};t.exports=r},{}],6:[function(e,t,n){"use strict";t.exports={checkStatus:function(e){var t={local:!1,online:!1};try{window.localStorage.setItem("checkStatus","a"),window.localStorage.getItem("checkStatus"),window.localStorage.removeItem("checkStatus"),t.local=!0}catch(e){}return t.online=window.navigator.onLine,t},getLocal:function(e){return window.localStorage.getItem(e)},setLocal:function(e,t){var n=!0;if(void 0===t)window.localStorage.removeItem(e);else try{window.localStorage.setItem(e,t)}catch(e){n=!1}return n}}},{}],7:[function(e,t,n){"use strict";function o(e,t){for(var n in e)"object"===i(e[n])&&"object"===i(t[n])&&null!==t[n]?null===e[n]?e[n]=d(t[n]):o(e[n],t[n]):e[n]=t[n];return e}function r(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];for(var o in t)null===t[o]&&n?Array.isArray(e)?e.splice(o,1):delete e[o]:"object"===i(t[o])&&null!==t[o]?(void 0===e[o]&&(e[o]=Array.isArray(t[o])?[]:{}),r(e[o],t[o],n)):e[o]=t[o];return e}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=e("./colors.js"),s=e("./time.js"),c=e("lz-string"),l="abcdefghijklmnopqrstuvwxyz0123456789",u=function(){for(var e=15,t="";e--;)t+=l.charAt(36*Math.random()>>0);return t},d=function(e){return Array.isArray(e)?r([],e,!1):r({},e,!1)},f={scene:function(){return{id:"s"+Date.now(),summary:"",body:"",wc:0,location:"",time:"",utctime:(new Date).toISOString(),thread:{}}},meta:function(){return{id:u(),title:"",author:"",email:"",modified:(new Date).toISOString(),wc:0,sc:0,nc:0}},location:function(e){return{id:"l"+Date.now(),name:"",color:e||a.locationColor(),folder:""}},thread:function(e){return{id:"t"+Date.now(),name:"",color:e||a.threadColor(),folder:"",time:{}}},folder:function(e){return{id:"f"+Date.now(),name:"",open:!0,color:a[e+"Color"](),items:[]}},note:function(){return{id:"n"+Date.now(),modified:"",tag:{},body:""}},project:function(){return{meta:f.meta(),scene:{},thread:{},location:{},note:{},threadList:[],threadFolders:[],locationList:[],locationFolders:[],folder:{},printSettings:{body:!0,summary:!1,date:!1,threads:!1,location:!1},chapters:[],past:[],future:[],visible:{},search:""}}},p={NewThread:function(e,t){var n=e.index,o=e.folder,r=e.color,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=f.thread(r),s=d(t.threadList);return void 0!==o?(a.folder=o,i=p.CreateThread(a,t,i),o=t.threadFolders[o],s=d(t.folder[o].items),s.splice(n,0,a.id),i=p.ModifyFolder({id:o,items:s},t,i)):(i=p.CreateThread(a,t,i),s=d(t.threadList),s.splice(n,0,a.id),i=p.ModifyThreadList(s,t,i)),s={},s[a.id]=a.id,i=p.ModifyVisible(s,t,i)},NewLocation:function(e,t){var n,o=e.index,r=e.folder,i=e.color,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=f.location(i);return void 0!==r?(s.folder=r,a=p.CreateLocation(s,t,a),r=t.locationFolders[r],n=d(t.folder[r].items),n.splice(o,0,s.id),a=p.ModifyFolder({id:r,items:n},t,a)):(a=p.CreateLocation(s,t,a),n=d(t.locationList),n.splice(o,0,s.id),a=p.ModifyLocationList(n,t,a)),n={},n[s.id]=s.id,a=p.ModifyVisible(n,t,a)},NewLocationFolder:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=f.folder("location"),r=d(t.locationFolders),i={};return n=p.CreateLocationFolder(o,t,n),r.splice(0,0,o.id),n=p.ModifyLocationFolders(r,t,n),i[o.id]=!0,n=p.ModifyVisible(i,t,n)},NewThreadFolder:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=f.folder("thread"),r=d(t.threadFolders),i={};return n=p.CreateThreadFolder(o,t,n),r.splice(0,0,o.id),n=p.ModifyThreadFolders(r,t,n),i[o.id]=!0,n=p.ModifyVisible(i,t,n)},RemoveThread:function(e,t){var n,o=e.id,r=e.folder,i=e.index,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return void 0===r?(a.threadList=d(t.threadList),t.threadList.splice(i,1)):(n=d(t.folder[r]),n.items.splice(i,1),n.items[n.items.length]=null,a=p.ModifyFolder(n,t,a)),a=p.DeleteThread(o,t,a)},RemoveLocation:function(e,t){var n,o=e.id,r=e.folder,i=e.index,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return void 0===r?(a.locationList=d(t.locationList),t.locationList.splice(i,1)):(n=d(t.folder[r]),n.items.splice(i,1),n.items[n.items.length]=null,a=p.ModifyFolder(n,t,a)),a=p.DeleteLocation(o,t,a)},RemoveFolder:function(e,t){var n=e.id,o=e.index,r=e.type,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.folder[n].items.forEach(function(e){return p["Thread"===r?"DeleteThread":"DeleteLocation"](e,t,i)}),"Thread"===r?(i.threadFolders=d(t.threadFolders),t.threadFolders.splice(o,1)):(i.locationFolders=d(t.locationFolders),t.locationFolders.splice(o,1)),i.folder=i.folder||{},i.folder[n]=t.folder[n],delete t.folder[n],i},CreateProject:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];Object.assign(t,r(f.project(),e))},CreateNote:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e=r(f.note(),e),n.note=n.note||{},n.note[e.id]=null,n.meta=n.meta||{},n.meta.nc=t.meta.nc,t.note[e.id]=e,t.meta.nc++,n.focus=e.id,n},CreateScene:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.utctime=s(e.time).ISOString,e=r(f.scene(),e),n.meta=n.meta||{},n.meta.sc=t.meta.sc,n.scene=n.scene||{},n.scene[e.id]=null,t.scene[e.id]=e,t.meta.sc++,n.focus=e.id,n},CreateThread:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e=r(f.thread(),e),n.thread=n.thread||{},n.thread[e.id]=null,e.name=e.name||"",t.thread[e.id]=e,n.focus=e.id,n},CreateLocation:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e=r(f.location(),e),n.location=n.location||{},n.location[e.id]=null,e.name=e.name||"",t.location[e.id]=e,n.focus=e.id,n},CreateLocationFolder:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e=r(f.folder("location"),e),n.folder=n.folder||{},n.folder[e.id]=null,t.folder[e.id]=e,n.focus=e.id,n},CreateThreadFolder:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e=r(f.folder("thread"),e),n.folder=n.folder||{},n.folder[e.id]=null,t.folder[e.id]=e,n.focus=e.id,n},ModifyScene:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=t.scene[e.id];if(i.scene=i.scene||{},i.scene[e.id]=o(d(e),t.scene[e.id]),e.wc&&(i.meta=i.meta||{},i.meta.wc=t.meta.wc,t.meta.wc+=e.wc-a.wc),void 0!==e.time){i.utctime=a.utctime,e.utctime=s(e.time).ISOString;for(var c in a.thread)n={id:c,time:d(t.thread[c].time)},n.time[a.utctime]=null,n.time[e.utctime]=!0,p.ModifyThread(n,t,i)}return r(a,e),i},ModifyThread:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.thread=n.thread||{},n.thread[e.id]=o(d(e),t.thread[e.id]),r(t.thread[e.id],e),n},ModifyThreadList:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.threadList=d(t.threadList),r(t.threadList,e),n},ModifyThreadFolders:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.threadFolders=d(t.threadFolders),r(t.threadFolders,e),n},ModifyLocation:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.location=n.location||{},n.location[e.id]=o(d(e),t.location[e.id]),r(t.location[e.id],e),n},ModifyLocationList:function(e,t){
var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.locationList=d(t.locationList),r(t.locationList,e),n},ModifyLocationFolders:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.locationFolders=d(t.locationFolders),r(t.locationFolders,e),n},ModifyFolder:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.folder=n.folder||{},n.folder[e.id]=o(d(e),t.folder[e.id]),r(t.folder[e.id],e),n},ModifyChapters:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.chapters=d(t.chapters),r(t.chapters,e),n},ModifyNote:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.modified=Date.now(),n.note=n.note||{},n.note[e.id]=o(d(e),t.note[e.id]),r(t.note[e.id],e),n},ModifyMeta:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.meta=o(d(e),t.meta),r(t.meta,e),n},ModifyVisible:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.visible=o(d(e),t.visible),r(t.visible,e),n},ModifySearch:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.search=t.search,t.search=e,n},ModifyPrintSettings:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.printSettings=o(d(e),t.meta),r(t.printSettings,e),n},MoveThread:function(e,t){var n,o,r,i=e.from,a=e.to,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return void 0===i.folder&&void 0===a.folder?(o=d(t.threadList),o.splice(a.index,0,o.splice(i.index,1)[0]),p.ModifyThreadList(o,t,s)):i.folder===a.folder?(r=t.threadFolders[i.folder],o=d(t.folder[r].items),o.splice(a.index,0,o.splice(i.index,1)[0]),p.ModifyFolder({id:t.folder[r].id,items:o},t,s)):(void 0!==i.folder?(r=t.threadFolders[i.folder],o=d(t.folder[r].items),n=o.splice(i.index,1)[0],o[o.length]=null,p.ModifyFolder({id:t.folder[r].id,items:o},t,s)):(o=d(t.threadList),n=o.splice(i.index,1)[0],o[o.length]=null,p.ModifyThreadList(o,t,s)),void 0!==a.folder?(r=t.threadFolders[a.folder],p.ModifyThread({id:n,folder:r},t,s),o=d(t.folder[r].items),o.splice(a.index,0,n),o[o.length]=null,p.ModifyFolder({id:t.folder[r].id,items:o},t,s)):(void 0!==i.folder&&p.ModifyThread({id:n,folder:""},t,s),o=d(t.threadList),o.splice(a.index,0,n),o[o.length]=null,p.ModifyThreadList(o,t,s))),s},MoveLocation:function(e,t){var n,o,r,i=e.from,a=e.to,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return void 0===i.folder&&void 0===a.folder?(o=d(t.locationList),o.splice(a.index,0,o.splice(i.index,1)[0]),p.ModifyLocationList(o,t,s)):i.folder===a.folder?(r=t.locationFolders[i.folder],o=d(t.folder[r].items),o.splice(a.index,0,o.splice(i.index,1)[0]),p.ModifyFolder({id:t.folder[r].id,items:o},t,s)):(void 0!==i.folder?(r=t.locationFolders[i.folder],o=d(t.folder[r].items),n=o.splice(i.index,1)[0],o[o.length]=null,p.ModifyFolder({id:t.folder[r].id,items:o},t,s)):(o=d(t.locationList),n=o.splice(i.index,1)[0],o[o.length]=null,p.ModifyLocationList(o,t,s)),void 0!==a.folder?(r=t.locationFolders[a.folder],p.ModifyLocation({id:n,folder:r},t,s),o=d(t.folder[r].items),o.splice(a.index,0,n),o[o.length]=null,p.ModifyFolder({id:t.folder[r].id,items:o},t,s)):(void 0!==i.folder&&p.ModifyLocation({id:n,folder:""},t,s),o=d(t.locationList),n=o.splice(a.index,0,n),o[o.length]=null,p.ModifyLocationList(o,t,s))),s},DeleteScene:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.scene=n.scene||{},n.meta=n.meta||{},n.scene[e]=t.scene[e],n.meta.wc=t.meta.wc,n.meta.sc=t.meta.sc,t.meta.sc--,t.meta.wc-=t.scene[e].wc,delete t.scene[e],n},DeleteThread:function(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};o.thread=o.thread||{},o.thread[e]=t.thread[e];for(var r in t.scene)if(t.scene[r].thread[e]){var i={id:r,thread:{}};i.thread[e]=null,p.ModifyScene(i,t,o)}for(var r in t.note)if(t.note[r].tag[e])if(Object.keys(t.note[r].tag).length>1){var a={id:r,tag:{}};a.tag[e]=null,p.ModifyNote(a,t,o)}else p.DeleteNote(r,t,o);return n={},n[e]=null,p.ModifyVisible(n,t,o),delete t.thread[e],o},DeleteLocation:function(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};o.location=o.location||{},o.scene=o.scene||{},o.location[e]=t.location[e];for(var r in t.scene)t.scene[r].location===e&&(o.scene[r]=t.scene[r],delete t.scene[r]);for(r in t.note)if(t.note[r].tag[e])if(Object.keys(t.note[r].tag).length>1){var i={id:r,tag:{}};i.tag[e]=null,p.ModifyNote(i,t,o)}else p.DeleteNote(r,t,o);return n={},n[e]=null,p.ModifyVisible(n,t,o),delete t.location[e],o},DeleteNote:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.note=n.note||{},n.note[e]=t.note[e],n.meta=n.meta||{},n.meta.nc=t.meta.nc,delete t.note[e],t.meta.nc--,n},ThreadScene:function(e,t){var n=e.scene,o=e.thread,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i={id:n,thread:{}};return i.thread[o]=!0,p.ModifyScene(i,t,r),i={id:o,time:d(t.thread[o].time)},i.time[t.scene[n].utctime]=n,p.ModifyThread(i,t,r),r},UnthreadScene:function(e,t){var n=e.scene,o=e.thread,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i={id:n,thread:{}};return i.thread[o]=null,p.ModifyScene(i,t,r),i={id:o,time:d(t.thread[o].time)},i.time[t.scene[n].utctime]=null,p.ModifyThread(i,t,r),r},Do:function(e,t,n){var o,r=null;return"ModifySearch"!==e&&"ModifyVisible"!==e?(o=p[e](t,n),r=o.focus,n.past.push(c.compressToUTF16(JSON.stringify(o))),n.past.length>40&&n.past.shift(),n.future.length&&(n.future=[])):p[e](t,n),n.meta.modified=(new Date).toISOString(),r},Undo:function(e){var t;e.past.length&&(t=JSON.parse(c.decompressFromUTF16(e.past.pop())),e.future.push(c.compressToUTF16(JSON.stringify(o(d(t),e)))),r(e,t)),e.meta.modified=(new Date).toISOString()},Redo:function(e){var t;e.future.length&&(t=JSON.parse(c.decompressFromUTF16(e.future.pop())),e.past.push(c.compressToUTF16(JSON.stringify(o(d(t),e)))),r(e,t)),e.meta.modified=(new Date).toISOString()}};t.exports=p},{"./colors.js":10,"./time.js":32,"lz-string":2}],8:[function(e,t,n){"use strict";t.exports=function(e){for(var t,n=e.constructor.prototype,o=Object.getOwnPropertyNames(n);t=o.pop();)"function"==typeof n[t]&&"constructor"!==t&&(e[t]=e[t].bind(e))}},{}],9:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("./bind.js"),c=e("preact"),l=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.state={color:e.color,hover:!1},s(i),i}return i(t,e),a(t,[{key:"renderSVG",value:function(e,t,n){var o=c.createElement("svg",{x:"0px",y:"0px",style:Object.assign({minWidth:"1rem",minHeight:"1rem",height:"1rem"},e.style||{})},c.createElement("g",{style:"fill: "+e.color+";"}));switch(e.img){case"eye":return o.attributes.viewBox="0 0 488.85 488.85",o.children[0].children=[c.createElement("path",{d:"M244.425,98.725c-93.4,0-178.1,51.1-240.6,134.1c-5.1,6.8-5.1,16.3,0,23.1c62.5,83.1,147.2,134.2,240.6,134.2s178.1-51.1,240.6-134.1c5.1-6.8,5.1-16.3,0-23.1C422.525,149.825,337.825,98.725,244.425,98.725z M251.125,347.025c-62,3.9-113.2-47.2-109.3-109.3c3.2-51.2,44.7-92.7,95.9-95.9c62-3.9,113.2,47.2,109.3,109.3C343.725,302.225,302.225,343.725,251.125,347.025z M248.025,299.625c-33.4,2.1-61-25.4-58.8-58.8c1.7-27.6,24.1-49.9,51.7-51.7c33.4-2.1,61,25.4,58.8,58.8C297.925,275.625,275.525,297.925,248.025,299.625z"})],o;case"delete":return o.attributes.viewBox="0 0 512 512",o.children[0].children=[c.createElement("path",{d:"M256,0C114.51,0,0,114.497,0,256c0,141.49,114.497,256,256,256c141.49,0,256-114.497,256-256C512,114.51,397.503,0,256,0z M360.121,335.987c6.665,6.664,6.665,17.471,0,24.136c-6.664,6.664-17.469,6.667-24.136,0L256,280.136l-79.986,79.987 c-6.665,6.665-17.471,6.665-24.136,0c-6.665-6.664-6.665-17.471,0-24.136L231.864,256l-79.986-79.987 c-6.665-6.664-6.665-17.471,0-24.136s17.471-6.665,24.136,0L256,231.864l79.986-79.987c6.664-6.664,17.471-6.664,24.136,0 c6.665,6.664,6.665,17.471,0,24.136L280.136,256L360.121,335.987z"})],o;case"print":return o.attributes.viewBox="0 0 212.925 212.925",o.children[0].children=[c.createElement("path",{d:"M180.575,186.114c4.142,0,7.5-3.357,7.5-7.5V7.5c0-4.143-3.358-7.5-7.5-7.5H40.319c-8.53,0-15.47,6.939-15.47,15.47v168.941c0,0.267,0.015,0.529,0.042,0.789c-0.015,0.276-0.042,0.55-0.042,0.83v11.292c0,8.604,7,15.603,15.604,15.603h115.531c0.007,0,0.013,0.001,0.019,0.001h24.572c4.142,0,7.5-3.357,7.5-7.5s-3.358-7.5-7.5-7.5h-0.937v-11.811H180.575z M164.639,197.924H40.453c-0.333,0-0.604-0.271-0.604-0.603v-11.207h124.789V197.924z M166.869,78.361c0,4.143-3.358,7.5-7.5,7.5H57.202c-4.142,0-7.5-3.357-7.5-7.5V59.027c0-4.143,3.358-7.5,7.5-7.5h102.167c4.142,0,7.5,3.357,7.5,7.5V78.361z"})],o;case"books":return o.attributes.viewBox="0 0 795.035 795.035",o.children[0].children=[c.createElement("path",{d:"M0,647.589c0,49.892,40.588,90.479,90.479,90.479h20.108h552.079h40.211h41.895v-40.212h-41.895V597.322h41.895v-17.594h20.104h30.16v-40.212h-30.16V438.989h30.16v-40.211h-30.16h-2.513v-13.395v-20.107v-0.863l-49.647-92.992h52.161v-54.073L633.665,56.968H170.738L51.356,245.075c-20.417,16.612-33.76,41.625-33.76,69.935c0,49.581,40.114,89.89,89.593,90.383c-33.291,13.372-56.922,45.847-56.922,83.864c0,27.604,12.688,52.046,32.242,68.656C36.395,562.022,0,600.426,0,647.589zM57.806,315.01c0-18.75,10.429-34.946,25.686-43.586h599.278v93.854H108.074C80.359,365.276,57.806,342.72,57.806,315.01zM140.747,438.991h20.106h563.809v100.526H160.853h-20.106c-27.715,0-50.268-22.541-50.268-50.26C90.48,461.53,113.032,438.991,140.747,438.991z M90.48,597.322h20.108h552.079v100.533h-552.08H90.479c-27.713,0-50.265-22.541-50.265-50.267C40.214,619.862,62.767,597.322,90.48,597.322z"})],o;case"help":return o.attributes.viewBox="0 0 31.521 31.521",o.children[0].children=[c.createElement("path",{d:"M26.943,4.654C20.81-1.521,10.832-1.556,4.654,4.579c-6.177,6.134-6.209,16.112-0.077,22.289c6.135,6.176,16.113,6.21,22.291,0.076C33.044,20.81,33.077,10.832,26.943,4.654z M22.588,3.923l-3.343,3.32c-2.208-0.902-4.696-0.911-6.91-0.024l-3.32-3.343C13.216,1.495,18.403,1.512,22.588,3.923z M7.221,19.187l-3.343,3.319c-2.383-4.201-2.365-9.388,0.047-13.573l3.321,3.343C6.342,14.483,6.334,16.972,7.221,19.187z M8.934,27.599l3.344-3.32c2.207,0.901,4.696,0.911,6.909,0.023l3.32,3.344C18.307,30.027,13.118,30.01,8.934,27.599z M20.776,20.812c-2.785,2.766-7.301,2.75-10.068-0.035c-2.766-2.785-2.75-7.301,0.036-10.067c2.786-2.766,7.301-2.751,10.067,0.034C23.578,13.529,23.562,18.045,20.776,20.812z M24.276,19.245c0.902-2.208,0.912-4.696,0.024-6.91l3.343-3.32c2.382,4.2,2.365,9.388-0.047,13.573L24.276,19.245z"})],o;case"Thread":return o.attributes.viewBox="0 0 512.005 512.005",o.children[0].children=[c.createElement("path",{d:"M448.261,319.739C483.407,319.739,512,291.146,512,256s-28.593-63.739-63.739-63.739h-32.392v-64.784h32.392 c35.146,0,63.739-28.593,63.739-63.739S483.407,0,448.261,0s-63.739,28.593-63.739,63.739v32.392h-64.784V63.739 C319.739,28.593,291.146,0,256,0s-63.739,28.593-63.739,63.739v32.392h-64.784V63.739C127.478,28.593,98.885,0,63.739,0 S0,28.593,0,63.739s28.593,63.739,63.739,63.739h32.392v64.784H63.739C28.593,192.261,0,220.854,0,256 s28.593,63.739,63.739,63.739h32.392v64.784H63.739C28.593,384.522,0,413.115,0,448.261S28.593,512,63.739,512 s63.739-28.593,63.739-63.739v-32.392h64.784v32.392C192.261,483.407,220.854,512,256,512s63.739-28.593,63.739-63.739v-32.392 h64.784v32.392c0,35.146,28.593,63.739,63.739,63.739S512,483.407,512,448.261s-28.593-63.739-63.739-63.739h-32.392v-64.784 H448.261z M415.869,63.739c0-17.86,14.53-32.392,32.392-32.392c17.861,0,32.392,14.531,32.392,32.392 c0,17.86-14.53,32.392-32.392,32.392h-32.392V63.739z M415.869,223.608h32.392c17.861,0,32.392,14.531,32.392,32.392 c0,17.86-14.53,32.392-32.392,32.392h-32.392V223.608z M96.131,448.261c0,17.86-14.53,32.392-32.392,32.392 c-17.861,0-32.392-14.531-32.392-32.392s14.53-32.392,32.392-32.392h32.392V448.261z M96.131,288.392H63.739 c-17.861,0-32.392-14.531-32.392-32.392s14.53-32.392,32.392-32.392h32.392V288.392z M96.131,96.131H63.739 c-17.861,0-32.392-14.531-32.392-32.392c0-17.86,14.53-32.392,32.392-32.392c17.862,0,32.392,14.531,32.392,32.392V96.131z M192.261,384.522h-64.784v-64.784h64.784V384.522z M192.261,288.392h-64.784v-64.784h64.784V288.392z M192.261,192.261h-64.784 v-64.784h64.784V192.261z M288.392,448.261c0,17.86-14.53,32.392-32.392,32.392c-17.861,0-32.392-14.531-32.392-32.392v-32.392 h64.784V448.261z M288.392,384.522h-64.784v-64.784h64.784V384.522z M288.392,288.392h-64.784v-64.784h64.784V288.392z M288.392,192.261h-64.784v-64.784h64.784V192.261z M288.392,96.131h-64.784V63.739c0-17.86,14.53-32.392,32.392-32.392 c17.862,0,32.392,14.531,32.392,32.392V96.131z M384.522,384.522h-64.784v-64.784h64.784V384.522z M384.522,288.392h-64.784 v-64.784h64.784V288.392z M384.522,192.261h-64.784v-64.784h64.784V192.261z M448.261,415.869 c17.861,0,32.392,14.531,32.392,32.392s-14.53,32.392-32.392,32.392c-17.862,0-32.392-14.531-32.392-32.392v-32.392H448.261z"})],o;case"Location":return o.attributes.viewBox="0 0 512 512",o.children[0].children=[c.createElement("path",{d:"M256,0C153.755,0,70.573,83.182,70.573,185.426c0,126.888,165.939,313.167,173.004,321.035 c6.636,7.391,18.222,7.378,24.846,0c7.065-7.868,173.004-194.147,173.004-321.035C441.425,83.182,358.244,0,256,0z M256,278.719 c-51.442,0-93.292-41.851-93.292-93.293S204.559,92.134,256,92.134s93.291,41.851,93.291,93.293S307.441,278.719,256,278.719z"})],o;case"search":return o.attributes.viewBox="0 0 30.239 30.239",o.children[0].children=[c.createElement("path",{d:"M20.194,3.46c-4.613-4.613-12.121-4.613-16.734,0c-4.612,4.614-4.612,12.121,0,16.735c4.108,4.107,10.506,4.547,15.116,1.34c0.097,0.459,0.319,0.897,0.676,1.254l6.718,6.718c0.979,0.977,2.561,0.977,3.535,0c0.978-0.978,0.978-2.56,0-3.535l-6.718-6.72c-0.355-0.354-0.794-0.577-1.253-0.674C24.743,13.967,24.303,7.57,20.194,3.46zM18.073,18.074c-3.444,3.444-9.049,3.444-12.492,0c-3.442-3.444-3.442-9.048,0-12.492c3.443-3.443,9.048-3.443,12.492,0C21.517,9.026,21.517,14.63,18.073,18.074z"})],o;case"add":return o.attributes.viewBox="0 0 27.963 27.963",o.attributes.style.width="0.8rem",o.children[0].children=[c.createElement("path",{d:"M13.98,0C6.259,0,0,6.26,0,13.982s6.259,13.981,13.98,13.981c7.725,0,13.983-6.26,13.983-13.981 C27.963,6.26,21.705,0,13.98,0z M21.102,16.059h-4.939v5.042h-4.299v-5.042H6.862V11.76h5.001v-4.9h4.299v4.9h4.939v4.299H21.102z"})],o;case"color":return o.attributes.viewBox="0 0 48.666 48.666",o.children[0].children=[c.createElement("path",{d:"M24.333,6.32C10.894,6.32,0,14.792,0,25.243c0,6.447,9.1,6.478,16.681,5.384c5.62-0.811,10.052,1.354,10.052,5.656s4.753,7.643,9.917,5.282c7.19-3.288,12.016-9.366,12.016-16.322C48.666,14.792,37.771,6.32,24.333,6.32z M8.996,20.389c-1.278,0-2.313-1.036-2.313-2.313c0-1.278,1.036-2.313,2.313-2.313s2.313,1.036,2.313,2.313S10.273,20.389,8.996,20.389z M16.564,15.414c-1.278,0-2.313-1.036-2.313-2.313c0-1.278,1.036-2.313,2.313-2.313c1.278,0,2.313,1.036,2.313,2.313C18.878,14.378,17.842,15.414,16.564,15.414z M26.646,14.6c-1.278,0-2.313-1.036-2.313-2.313c0-1.278,1.036-2.313,2.313-2.313c1.278,0,2.313,1.036,2.313,2.313S27.924,14.6,26.646,14.6zM34.957,37.648c-2.116,0-3.831-1.715-3.831-3.831s1.715-3.831,3.831-3.831s3.831,1.715,3.831,3.831C38.788,35.931,37.073,37.648,34.957,37.648z M36.475,17.726c-1.277,0-2.312-1.036-2.312-2.313s1.035-2.313,2.312-2.313c1.278,0,2.313,1.036,2.313,2.313C38.788,16.691,37.752,17.726,36.475,17.726z M41.102,26.647c-1.277,0-2.312-1.036-2.312-2.313c0-1.278,1.036-2.313,2.312-2.313c1.278,0,2.313,1.036,2.313,2.313S42.379,26.647,41.102,26.647z"})],o;case"document":return o.attributes.viewBox="0 0 26.738 26.738",o.children[0].children=[c.createElement("path",{d:"M16.466,5.957H6.211V4.233h10.255V5.957z M20.492,4.233h-2.546v1.724h2.546V4.233z M6.211,9.26h14.281V7.536H6.211V9.26z M13.024,10.84v1.724h7.467V10.84H13.024z M11.58,10.84H6.211v1.724h5.368C11.579,12.564,11.579,10.84,11.58,10.84z M6.211,15.867h14.281v-1.724H6.211V15.867z M14.299,17.446H6.211v1.724h8.087C14.298,19.17,14.298,17.446,14.299,17.446z M15.708,17.446v1.724h4.783v-1.724H15.708z M6.211,22.474h14.281V20.75H6.211V22.474zM24.621,3.167v20.404c0,1.746-1.244,3.167-2.773,3.167H4.889c-1.529,0-2.773-1.421-2.773-3.167V3.167C2.116,1.421,3.36,0,4.889,0h16.959C23.377,0,24.621,1.421,24.621,3.167z M22.97,3.167c0-0.821-0.513-1.515-1.121-1.515H4.889c-0.608,0-1.121,0.694-1.121,1.515v20.404c0,0.821,0.513,1.515,1.121,1.515h16.959c0.608,0,1.121-0.694,1.121-1.515V3.167z"})],o;case"group":return o.attributes.viewBox="0 0 593.523 593.523",o.children[0].children=[c.createElement("path",{d:"M584.344,133.083H275.342c-5.07,0-12.182-2.806-15.888-6.267L226.22,95.758c-3.706-3.461-10.817-6.267-15.888-6.267H9.18 c-5.07,0-9.18,4.109-9.18,9.18v396.182c0,5.07,4.109,9.18,9.18,9.18h575.164c5.07,0,9.18-4.109,9.18-9.18V142.264 C593.523,137.193,589.414,133.083,584.344,133.083z M432.932,357.278H331.267v101.664h-69.009V357.278H160.592v-69.01h101.666 V186.603h69.012v101.666h101.662V357.278z"})],o;case"note":return o.attributes.viewBox="0 0 330.853 330.853",o.children[0].children=[c.createElement("path",{d:"M277.656,31.186h-32.882v-17.96C244.774,5.921,238.854,0,231.552,0c-7.309,0-13.223,5.927-13.223,13.226v17.96h-17.63 v-17.96C200.699,5.921,194.778,0,187.477,0c-7.314,0-13.223,5.927-13.223,13.226v17.96h-17.643v-17.96 c0-7.305-5.92-13.226-13.226-13.226c-7.305,0-13.219,5.927-13.219,13.226v17.96h-17.642v-17.96C112.524,5.921,106.609,0,99.299,0 c-7.305,0-13.22,5.927-13.22,13.226v17.96H53.182c-7.305,0-13.22,5.93-13.22,13.229V317.63c0,7.302,5.915,13.223,13.22,13.223 h224.486c7.302,0,13.223-5.927,13.223-13.223V44.421C290.891,37.116,284.97,31.186,277.656,31.186z M165.412,271.453H99.293 c-7.305,0-13.22-5.921-13.22-13.223s5.915-13.223,13.22-13.223h66.119c7.305,0,13.226,5.921,13.226,13.223 C178.644,265.532,172.723,271.453,165.412,271.453z M231.552,227.365H99.293c-7.305,0-13.22-5.92-13.22-13.222 s5.915-13.223,13.22-13.223h132.259c7.302,0,13.223,5.921,13.223,13.223S238.865,227.365,231.552,227.365z M231.552,183.291H99.293 c-7.305,0-13.22-5.921-13.22-13.235c0-7.292,5.915-13.216,13.22-13.216h132.259c7.302,0,13.223,5.93,13.223,13.216 C244.774,177.357,238.865,183.291,231.552,183.291z M231.552,139.2H99.293c-7.305,0-13.22-5.93-13.22-13.223 c0-7.305,5.915-13.226,13.22-13.226h132.259c7.302,0,13.223,5.927,13.223,13.226C244.774,133.271,238.865,139.2,231.552,139.2z"})],o;case"filter":return o.attributes.viewBox="0 0 402.577 402.577",o.children[0].children=[c.createElement("path",{d:"M400.858,11.427c-3.241-7.421-8.85-11.132-16.854-11.136H18.564c-7.993,0-13.61,3.715-16.846,11.136 c-3.234,7.801-1.903,14.467,3.999,19.985l140.757,140.753v138.755c0,4.955,1.809,9.232,5.424,12.854l73.085,73.083 c3.429,3.614,7.71,5.428,12.851,5.428c2.282,0,4.66-0.479,7.135-1.43c7.426-3.238,11.14-8.851,11.14-16.845V172.166L396.861,31.413 C402.765,25.895,404.093,19.231,400.858,11.427z"})],o;case"gear":return o.attributes.viewBox="0 0 54 54",o.children[0].children=[c.createElement("path",{d:"M51.22,21h-5.052c-0.812,0-1.481-0.447-1.792-1.197s-0.153-1.54,0.42-2.114l3.572-3.571 c0.525-0.525,0.814-1.224,0.814-1.966c0-0.743-0.289-1.441-0.814-1.967l-4.553-4.553c-1.05-1.05-2.881-1.052-3.933,0l-3.571,3.571 c-0.475,0.475-0.997,0.574-1.352,0.574c-0.5,0-0.997-0.196-1.364-0.539C33.324,8.984,33,8.534,33,7.832V2.78 C33,1.247,31.753,0,30.22,0H23.78C22.247,0,21,1.247,21,2.78v5.052c0,1.218-0.997,1.945-1.961,1.945c-0.354,0-0.876-0.1-1.351-0.574 l-3.571-3.571c-1.052-1.052-2.883-1.05-3.933,0l-4.553,4.553c-0.525,0.525-0.814,1.224-0.814,1.967c0,0.742,0.289,1.44,0.814,1.966 l3.572,3.571c0.573,0.574,0.73,1.364,0.42,2.114S8.644,21,7.832,21H2.78C1.247,21,0,22.247,0,23.78v6.438C0,31.752,1.247,33,2.78,33 h5.052c0.812,0,1.481,0.447,1.792,1.197s0.153,1.54-0.42,2.114l-3.572,3.571c-0.525,0.525-0.814,1.224-0.814,1.966 c0,0.743,0.289,1.441,0.814,1.967l4.553,4.553c1.051,1.051,2.881,1.053,3.933,0l3.571-3.571c0.475-0.475,0.997-0.574,1.352-0.574 c0.963,0,1.96,0.728,1.96,1.945v5.051C21,52.752,22.247,54,23.78,54h6.439c1.533,0,2.78-1.248,2.78-2.781v-5.051 c0-1.218,0.997-1.945,1.96-1.945c0.354,0,0.877,0.1,1.352,0.574l3.571,3.571c1.052,1.052,2.883,1.05,3.933,0l4.553-4.553 c0.525-0.525,0.814-1.224,0.814-1.967c0-0.742-0.289-1.44-0.814-1.966l-3.572-3.571c-0.573-0.574-0.73-1.364-0.42-2.114 S45.356,33,46.168,33h5.052c1.533,0,2.78-1.248,2.78-2.781V23.78C54,22.247,52.753,21,51.22,21z M34,27c0,3.859-3.141,7-7,7 s-7-3.141-7-7s3.141-7,7-7S34,23.141,34,27z"})],o;case"craft":return o.attributes.viewBox="0 0 512 512",o.children[0].children=[c.createElement("path",{d:"M201.275,96.165l-11.919,11.919c-26.292,26.288-69.069,26.291-95.361,0C73.27,87.359,68.273,55.9,81.564,29.807 c4.226-8.296,0.925-18.446-7.371-22.672c-8.294-4.228-18.446-0.926-22.672,7.371c-19.938,39.146-12.449,86.334,18.636,117.419 c39.438,39.438,103.606,39.436,143.039,0l11.919-11.919c12.858-12.856,27.97-22.117,44.074-27.789 c11.784-14.763,22.661-28.319,32.306-40.252C265.03,53.649,229.061,68.381,201.275,96.165z"}),c.createElement("path",{d:"M482.189,430.439c-26.096,13.286-57.55,8.288-78.274-12.435c-12.735-12.735-19.749-29.668-19.749-47.679 s7.014-34.944,19.749-47.68l11.92-11.92c38.118-38.118,51.665-91.639,40.656-140.712c16.229-13.253,27.199-22.501,30.862-26.166 c32.862-32.863,32.862-86.335,0-119.198c-32.863-32.863-86.336-32.863-119.199,0C341.393,51.407,17.343,467.097,3.562,484.779 c-5.23,6.71-4.64,16.267,1.377,22.282c3.27,3.271,7.587,4.938,11.924,4.938c3.64,0,7.296-1.174,10.358-3.561 c13.964-10.882,276.103-215.232,398.944-313.896c2.484,33.111-8.903,67.077-34.169,92.343l-11.92,11.92 c-19.104,19.104-29.624,44.503-29.624,71.52c0,27.016,10.521,52.416,29.625,71.519c19.485,19.486,45.291,29.7,71.484,29.698 c15.59-0.001,31.322-3.621,45.927-11.06c8.297-4.224,11.597-14.375,7.372-22.671C500.635,429.514,490.482,426.215,482.189,430.439 z M415.835,96.165l-0.001-0.001l-23.84,23.84l0.001,0.001c4.047,4.047,7.73,8.321,11.064,12.774l-11.065,11.065 c-3.292,3.292-7.607,4.938-11.919,4.938c-4.314,0-8.629-1.645-11.919-4.938c-6.583-6.582-6.583-17.256,0-23.84l47.68-47.679 c6.583-6.583,17.257-6.583,23.84,0c6.583,6.582,6.583,17.256,0,23.84l-12.587,12.586 C423.608,104.401,419.864,100.194,415.835,96.165z"})],o;case"default":return""}}},{key:"render",value:function(e,t,n){var o=this;return c.createElement("span",{style:{display:"flex",alignItems:"center",opacity:e.noOpacity||t.hover?"1":"0.6",cursor:"pointer"},onclick:function(t){e.onclick&&e.onclick(t)},onmouseenter:function(t){e.hoverColor&&o.setState({color:e.hoverColor,hover:!0}),e.onmouseenter&&e.onmouseenter(t)},onmouseleave:function(t){e.hoverColor&&o.setState({color:e.color,hover:!1}),e.onmouseleave&&e.onmouseleave(t)},onmousedown:function(t){e.onmousedown&&e.onmousedown(t)},onmouseup:function(t){e.onmouseup&&e.onmouseup(t)},onmousemove:function(t){e.onmousemove&&e.onmousemove(t)}},c.createElement(this.renderSVG,{img:e.img,style:e.style,color:t.color}),e.text?c.createElement("span",{style:{fontSize:"0.9rem",fontWeight:"bold",color:"#000",marginLeft:"0.5rem"}},e.text):"")}}]),t}(c.Component);t.exports=l},{"./bind.js":8,preact:3}],10:[function(e,t,n){"use strict";for(var o=[],r=[],i=0;i<360;)o.push("hsl("+i+", 100%, 40%)"),r.push("hsl("+i+", 20%, 20%)"),i+=10;t.exports={Location:r,Thread:o,threadColor:function(e){return o[Math.random()*o.length>>0]},locationColor:function(e){return r[Math.random()*r.length>>0]},next:function(e,t){return(t=o.indexOf(e))!==-1?o[++t===o.length?0:t]:(t=r.indexOf(e),t!==-1?r[++t===r.length?0:t]:void 0)}}},{}],11:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l=e("../time.js"),u=e("./ImmutableInput.js"),d=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.state={invalidText:""},c(i),i}return i(t,e),a(t,[{key:"componentWillUpdate",value:function(){this.validate(this.props.value)}},{key:"render",value:function(e,t,n){return s.createElement("span",{style:Object.assign({},e.style,{color:t.invalidText.length?"#fa8072":e.style.color||"inherit"})},s.createElement(u,{style:{outline:"none",border:"none",backgroundColor:"inherit"},type:"text",maxLength:"24",placeholder:"Date & Time",value:e.value,oninput:this.onInput,onchange:this.onChange,onfocus:e.onfocus,onblur:e.onblur}),t.invalidText)}},{key:"validate",value:function(e){var t=l(e),n="";t.isValid?this.context.doesTimeConflict(this.props.location,t.ISOString,this.props.scene||"")&&(n="Date Conflict!"):n="Invalid Date!",this.setState({invalidText:n})}},{key:"onInput",value:function(e){this.validate(e.target.value)}},{key:"onChange",value:function(e){0===this.state.invalidText.length&&this.props.onchange(e)}}]),t}(s.Component);t.exports=d},{"../bind.js":8,"../time.js":32,"./ImmutableInput.js":18,preact:3}],12:[function(e,t,n){"use strict";function o(e,t,n){return r.createElement("ol",{style:Object.assign(e.style||{},s.list)},e.items.map(function(t,n){return r.createElement(i,{style:s.draggable,type:e.type,effect:"move",payload:Object.assign({id:t,index:n},e.payload||{}),onDragStart:function(e){var t=document.getElementById("defocuser");e.cancelBubble=!0,t.focus(),t.blur()}},r.createElement(a,{type:e.type,effect:"move",onDrop:function(t){return e.onMove(t,Object.assign({index:n},e.payload||{}))}},e.item(t,n)))}).concat([r.createElement(a,{style:{height:"1rem"},type:e.type,effect:"move",onDrop:function(t){return e.onMove(t,Object.assign({index:e.items.length},e.payload||{}))}}," ")]))}var r=e("preact"),i=(e("../bind.js"),e("./Draggable.js")),a=e("./DropZone.js"),s={list:{display:"flex"},draggable:{zIndex:26,position:"relative"}};t.exports=o},{"../bind.js":8,"./Draggable.js":14,"./DropZone.js":15,preact:3}],13:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l=e("../colors.js"),u=e("./SidebarItem.js"),d=e("./DragList.js"),f=e("./ScrollingView.js"),p=e("../buttons.js"),h=(e("./Draggable.js"),e("./DropZone.js")),m=e("./ImmutableInput.js"),y={text:{width:"10rem",padding:"0.3rem 0.5rem 0.3rem 0",border:"none",outline:"none",backgroundColor:"rgba(0,0,0,0)",fontSize:"0.9rem",color:"#fff"},thread:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.9rem",padding:"0 0 0 0.5rem",margin:"1px 0",borderRadius:"0.15rem"},hide:{cursor:"pointer",marginRight:"1rem",width:"1rem",height:"1rem"},delete:{cursor:"pointer",marginRight:"0.5rem",width:"1rem",height:"1rem"},list:{flexDirection:"column",padding:"0 0.25rem"},item:{margin:"0 0.25rem",width:"1rem",height:"1rem",border:"none",outline:"none",backgroundColor:"inherit",color:"#fff",fontSize:"1.2rem",cursor:"pointer",lineHeight:"1rem"},row:{display:"flex",justifyContent:"flex-start",alignItems:"center",color:"#fff",fontSize:"0.8rem"}},v=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.state={hover:-1,colorPicker:!1},c(i),i}return i(t,e),a(t,[{key:"render",value:function(e,t,n){var o=this;return s.createElement(u,{style:{flexGrow:1,minHeight:"40vh",borderTop:"1px solid #000"},buttons:[s.createElement(p,{img:e.type,color:"#000",text:"Thread"===e.type?"Threads":"Places",noOpacity:!0}),s.createElement(p,{img:"group",color:"#444",hoverColor:"#000",style:y.item,onclick:function(t){n.Do("New"+e.type+"Folder")}}),s.createElement(p,{img:"add",color:"#444",hoverColor:"#000",style:y.item,onclick:function(e){o.setState({colorPicker:!0})}})]},t.colorPicker?s.createElement("div",{style:Object.assign({},y.thread,{position:"relative",height:"1.8rem",margin:"1px 0.25rem",padding:"0",borderRadius:"0.25rem",overflow:"hidden"})},l[e.type].map(function(t,r){return s.createElement("span",{class:"noselect",style:{flexGrow:"1",height:"100%",backgroundColor:t,cursor:"pointer"},onclick:function(r){o.state.colorPicker=!1,n.Do("New"+e.type,{index:0,color:t})}}," ")}),s.createElement("div",{style:{position:"absolute",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",pointerEvents:"none"}},s.createElement("span",{class:"noselect"},"Pick a color."))):"",s.createElement(f,{style:{flexGrow:1,width:"100%",minHeight:"1rem"}},s.createElement(d,{style:y.list,type:e.type,items:e.free,onMove:this.onMove,item:function(e,t){return s.createElement(o.renderItem,{key:e,item:n.Get(e),index:t,inset:"0"})}}),s.createElement(d,{style:y.list,type:"Folder",items:e.folders,onMove:this.moveFolder,item:function(e,t){return s.createElement(o.renderFolder,{key:e,folder:n.Get(e),index:t})}})))}},{key:"renderItem",value:function(e,t){var n=this;return s.createElement("div",{style:Object.assign({},y.thread,{backgroundColor:e.item.color,opacity:this.props.visible[e.item.id]?1:.75,marginLeft:e.inset}),onmouseover:function(t){return n.onHover(e.item.id)},onmouseleave:function(e){return n.onHover(-1)}},s.createElement(m,{placeholder:"Name",maxLength:"40",value:e.item.name,ref:function(n){n&&e.item.id===t.focus&&(n.base.focus(),t.eatFocus())},type:"text",style:Object.assign({},y.text,e.style),onmouseover:function(e){return e.target.readOnly=!0},onclick:function(e){e.target.focus()},onchange:function(o){t.Do("Modify"+n.props.type,{id:e.item.id,name:o.target.value})}}),s.createElement("div",{style:{width:"3rem",display:"flex",justifyContent:"flex-end",alignItems:"center"}},this.state.hover===e.item.id?s.createElement(p,{noOpacity:!0,img:"delete",color:"#000",hoverColor:"#f00",style:y.delete,onclick:function(e){n.timer&&(clearTimeout(n.timer),n.timer=void 0)},onmousedown:function(o){n.timer=setTimeout(t.Do,1e3,"Remove"+n.props.type,{id:e.item.id,index:e.index})}}):""," ",this.state.hover!==e.item.id&&this.props.visible[e.item.id]?"":s.createElement(p,{img:"eye",color:this.props.btnColor,style:y.hide,noOpacity:!0,onclick:function(o){var r={};o.stopPropagation(),
r[e.item.id]=!n.props.visible[e.item.id],t.Do("ModifyVisible",r)}})))}},{key:"renderFolder",value:function(e,t){var n=this;return s.createElement("div",{style:{marginTop:"1px"}},s.createElement(h,{style:Object.assign({backgroundColor:"#666",opacity:this.props.visible[e.folder.id]?"1":"0.5"},y.thread,{padding:"0 0.25rem 0 0"}),type:this.props.type,effect:"move",onMouseEnter:function(t){return n.setState({hover:e.folder.id})},onMouseLeave:function(e){return n.setState({hover:-1})},onDrop:function(t){return n.onMove(t,Object.assign({folder:e.index,index:0},e.payload||{}))}},s.createElement("div",null,s.createElement("button",{style:y.item,onclick:function(){return t.Do("ModifyFolder",{id:e.folder.id,open:!e.folder.open})}},e.folder.open?"-":"+"),s.createElement(m,{placeholder:"Group",maxLength:"40",value:e.folder.name,class:"noselect",type:"text",style:y.text,onmouseover:function(e){return e.target.readOnly=!0},onclick:function(e){e.target.focus()},onfocus:function(e){e.target.readOnly=!1,e.target.class=""},onchange:function(n){t.Do("ModifyFolder",{id:e.folder.id,name:n.target.value})},onblur:function(e){e.target.readOnly=!0,e.target.class="noselect"}})),s.createElement("div",{style:{display:"flex",alignItems:"center"}},this.state.hover===e.folder.id?s.createElement(p,{img:"delete",color:"#000",hoverColor:"#f00",style:y.delete,onclick:function(e){n.timer&&(clearTimeout(n.timer),n.timer=void 0)},onmousedown:function(o){n.timer=setTimeout(t.Do,1e3,"RemoveFolder",{id:e.folder.id,index:e.index,type:n.props.type})}}):"",this.state.hover!==e.folder.id&&this.props.visible[e.folder.id]?"":s.createElement(p,{img:"eye",color:this.props.btnColor,style:Object.assign({},y.hide,{marginRight:"0.75rem"}),onclick:function(o){var r={},i=0;if(o.stopPropagation(),n.props.visible[e.folder.id])i=void 0;else{for(var a in e.folder.items)i+=n.props.visible[e.folder.items[a]]?1:0;i=!(i/e.folder.items.length>.5)||void 0}for(var a in e.folder.items)r[e.folder.items[a]]=i;r[e.folder.id]=i,t.Do("ModifyVisible",r)}}))),e.folder.open?s.createElement(d,{style:Object.assign({},y.list,{padding:"0"}),type:this.props.type,items:e.folder.items,onMove:this.onMove,payload:{folder:e.index},item:function(o,r){return s.createElement(n.renderItem,{visible:e.visible,item:t.Get(o),index:r,folder:e.index,inset:"1rem"})}}):"")}},{key:"onHover",value:function(e){this.setState({hover:e})}},{key:"onMove",value:function(e,t){this.context.Do("Move"+this.props.type,{from:e,to:t})}},{key:"moveFolder",value:function(e,t){var n=Object.assign([],this.props.folders);n.splice(t.index,0,n.splice(e.index,1)[0]),this.context.Do("Modify"+this.props.type+"Folders",n)}}]),t}(s.Component);t.exports=v},{"../bind.js":8,"../buttons.js":9,"../colors.js":10,"./DragList.js":12,"./Draggable.js":14,"./DropZone.js":15,"./ImmutableInput.js":18,"./ScrollingView.js":26,"./SidebarItem.js":27,preact:3}],14:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return c(i),i}return i(t,e),a(t,[{key:"render",value:function(e,t,n){return s.createElement("div",{class:e.class,style:e.style,draggable:!0,onDrag:this.onDrag,onDragStart:this.onDragStart,onDragEnd:this.onDragEnd,onDragExit:this.onDragExit,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},e.children)}},{key:"onDrag",value:function(e){this.props.onDrag&&this.props.onDrag(e)}},{key:"onDragStart",value:function(e){var t=JSON.stringify(void 0!==this.props.payload?this.props.payload:"payload");e.dataTransfer.effectAllowed=this.props.effect,e.dataTransfer.setData(this.props.type,t),this.props.onDragStart&&this.props.onDragStart(e)}},{key:"onDragEnd",value:function(e){this.props.onDragEnd&&this.props.onDragEnd(e)}},{key:"onDragExit",value:function(e){this.props.onDragExit&&this.props.onDragExit(e)}},{key:"onMouseDown",value:function(e){this.props.onMouseDown&&this.props.onMouseDown(e)}},{key:"onMouseUp",value:function(e){this.props.onMouseUp&&this.props.onMouseUp(e)}},{key:"onMouseEnter",value:function(e){this.props.onMouseEnter&&this.props.onMouseEnter(e)}},{key:"onMouseLeave",value:function(e){this.props.onMouseLeave&&this.props.onMouseLeave(e)}}]),t}(s.Component);t.exports=l},{"../bind.js":8,preact:3}],15:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return c(i),i}return i(t,e),a(t,[{key:"render",value:function(e,t){return s.createElement("div",{style:e.style,onDragEnter:this.onDragEnter,onDragOver:this.onDragOver,onDragLeave:this.onDragLeave,onDrop:this.onDrop,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave},e.children)}},{key:"onDrop",value:function(e){var t=JSON.parse(e.dataTransfer.getData(void 0!==this.typeIndex?this.props.type[this.typeIndex]:this.props.type));this.props.onDrop&&this.props.onDrop(t,e)}},{key:"onDragEnter",value:function(e){var t=!1;if(this.typeIndex=void 0,Array.isArray(this.props.type)){for(var n in this.props.type)if(e.dataTransfer.types.includes(this.props.type[n].toLowerCase())){this.typeIndex=n,t=!0;break}}else e.dataTransfer.types[0]===this.props.type.toLowerCase()&&(t=!0);t&&(e.dataTransfer.dropEffect=this.props.effect,e.preventDefault(),this.props.onDragEnter&&this.props.onDragEnter(e))}},{key:"onDragOver",value:function(e){var t=!1;if(this.typeIndex=void 0,Array.isArray(this.props.type)){for(var n in this.props.type)if(e.dataTransfer.types.includes(this.props.type[n].toLowerCase())){this.typeIndex=n,t=!0;break}}else e.dataTransfer.types[0]===this.props.type.toLowerCase()&&(t=!0);t&&(e.dataTransfer.dropEffect=this.props.effect,e.preventDefault(),this.props.onDragOver&&this.props.onDragOver(e))}},{key:"onDragLeave",value:function(e){this.props.onDragLeave&&this.props.onDragLeave(e)}}]),t}(s.Component);t.exports=l},{"../bind.js":8,preact:3}],16:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l={editBox:{outline:"none",border:"none",overflow:"hidden",resize:"none"}},u=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.state={value:e.value},c(i),i}return i(t,e),a(t,[{key:"render",value:function(e,t){var n=this;return s.createElement("textarea",{draggable:!0,style:Object.assign({},l.editBox,e.style),ref:function(e){return n.el=e},maxlength:e.maxlength,placeholder:e.placeholder,onmouseover:e.onmouseover,oninput:this.onInput,onchange:e.onchange,onfocus:e.onfocus,onblur:e.onblur,ondragstart:e.ondragstart,onkeyup:e.onkeyup,value:e.value})}},{key:"shouldComponentUpdate",value:function(e,t,n){return!this.timer}},{key:"componentWillReceiveProps",value:function(e){e.value!==this.state.value&&this.setState({value:e.value},this.doResize)}},{key:"componentDidMount",value:function(){this.doResize(),window.addEventListener("resize",this.doResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.doResize)}},{key:"onInput",value:function(e){this.timer&&clearTimeout(this.timer),this.timer=setTimeout(this.onTimer,this.props.buffer||0,e)}},{key:"onTimer",value:function(e){this.timer=void 0,this.state.value=e.target.value,this.doResize(),this.props.oninput(e)}},{key:"doResize",value:function(){var e=window.document.body.scrollTop,t=window.document.body.scrollLeft;this.el.style.height=this.props.baseHeight,this.el.style.height=this.el.scrollHeight+"px",window.document.body.scrollTo(t,e)}}]),t}(s.Component);t.exports=u},{"../bind.js":8,preact:3}],17:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l=e("./ModalView.js"),u=(e("../colors.js"),e("./SidebarItem.js")),d=(e("./DragList.js"),e("./ScrollingView.js")),f=(e("../buttons.js"),e("./Draggable.js"),e("./DropZone.js"),e("./ImmutableInput.js"),{title:{fontSize:"1.5rem",fontWeight:"bold"},subtitle:{fontSize:"1.2rem",fontWeight:"bold",height:"1.5rem"},body:{margin:"0.5rem 0 0 0",fontSize:"1rem",fontWeight:"normal",width:"100%"},modal:{posiition:"relative",backgroundColor:"#fff",color:"#000",borderRadius:"0.15rem",alignItems:"flex-start",width:"50rem"},img:{backgroundColor:"#777",float:"left",width:"25rem",marginRight:"1rem",height:"25rem"},box:{backgroundColor:"#fff",color:"#000",margin:"0 0.5rem 0.5rem 0.5rem",padding:"0.25rem 0.5rem",borderRadius:"0.15rem"},button:{color:"#000",textDecoration:"none",cursor:"pointer",margin:"0.15rem 0 0.15rem 1rem"},group:{display:"flex",flexDirection:"column",paddingLeft:"1rem"},header:{fontSize:"0.9rem",fontWeight:"bold",margin:"0.25rem 0"},current:{margin:"0.5rem",width:"1rem",height:"1rem",borderRadius:"0.5rem",backgroundColor:"#444"},page:{margin:"0.5rem",width:"1rem",height:"1rem",borderRadius:"0.5rem",backgroundColor:"#ccc",cursor:"pointer"}}),p=["User Interface","Scenes","Notebar","Plot Sidebar",["Places","Threads","Search"],"Book Sidebar",["Chapters","Printing"]],h={"User Interface":["Weave is mouse and keyboard driven.","On the left is the Sidebar, which can be shown/hidden using: CMD B (Mac) or CTRL B (Windows/Linux)","On the right is the Notebar, which can be shown/hidden using: CMD K (Mac) or CTRL K (Windows/Linux)","In the Plot Sidebar is the Search bar, which can be access from keyboard using: CMD F (Mac) or CTRL F (Windows/Linux)","The main view shows Place columns with any visible scenes layed in time order.","You can increase/decrease the font size using: CMD +/- (Mac) or CTRL +/- (Windows/Linux)","Delete buttons require you to hold down the mouse button to really confirm your intention."],Scenes:["Scenes are the foundational building block of your story.","You must have an existing and visible Place to create a Scene. Click the add button at the top of each Place column to add a Scene to that location. Dates can be as broad as a year, or can specified down to the minute. If there exists a Scene with a conflicting date, or the date is invalid: the scene will not be created when you press Enter.","Click on the edit button on a Scene to enter the distraction-free writing mode"],Notebar:["Weave understands that Notes are critical for good storytelling, and the Notebar keeps your notes right next to wherever you're working.","Notes can be tagged with Threads and Places so they'll only show up when they're relevant."],"Plot Sidebar":["The Plot Sidebar is where you can create and modify Places and Threads, as well as Folders to organize them.","You can Search and/or Hide Scenes and Notes based on their Place and Thread, and their text contents."],Places:["Your Scenes unfold in Places.","Places can be grouped into named Folders, and all Places within a Folder can be hidden or shown at once."],Threads:["Threads make it easy to track your characters through Scenes, but can be used for any important element in your story: like the Ring of Power, or the Thumb Drive of Secrets.","As with Places: Threads can be grouped into named Folders, and can be hidden or shown at once."],Search:["Searching your Scenes and Notes is trivial with the Search Bar.","Search is not case-sensitive, and only Scenes and Notes containing the Search term in their text content, or in their tagged Thread or Location name(s)."],"Book Sidebar":["The Book Sidebar is where you can name your Book and layout your Scenes in Chapters","At the top of this Sidebar, you can name your Book, and yourself as it's Author.","Below the Title and Author fields is the Chapters list, where you can layout your Chapters.","At the bottom is the Print Panel where you can print your Book."],Chapters:["Click the add button to create a new Chapter.","Drag and drop Scenes or Notes onto any Chapter to add them to it.","If you want to rearrange your chapters: drag and drop them."],Printing:["The Print Panel is where you can toggle which fields within a Scene you would like to be printed.","Pressing the Print button will open the File Saving dialog box where you can choose where to save the plain text printed output of your Book."]},m=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.state={modal:void 0},i.focus=!1,c(i),i}return i(t,e),a(t,[{key:"renderButton",value:function(e,t){var n=this;return"string"==typeof e?s.createElement("span",{style:f.button,onmouseenter:function(e){return e.target.style.fontWeight="bold"},onmouseleave:function(e){return e.target.style.fontWeight="normal"},onclick:function(){return n.setState({modal:e})}},e):s.createElement("div",{style:f.group},e.map(this.renderButton))}},{key:"render",value:function(e,t,n){var o=this;return s.createElement(d,{style:{flexGrow:1,width:"100%",minHeight:"1rem",display:"flex",flexDirection:"column",alignItems:"stretch"}},s.createElement(u,{style:{display:"flex",flexDirection:"column",alignItems:"stretch",color:"#000",fontSize:"1rem",padding:"0"},buttons:s.createElement("span",{style:f.header},"About")},s.createElement("div",{style:f.box},s.createElement("p",null,"Weave is an app for writers. ",s.createElement("b",null,"Place")," your ",s.createElement("b",null,"Scenes")," in time, and ",s.createElement("b",null,"Thread")," your characters through them. ",s.createElement("b",null,"Write")," your scenes in a simple, distraction-free text editor.  Search your ",s.createElement("b",null,"Notes")," and ",s.createElement("b",null,"Scenes")," with ease."),s.createElement("p",{style:{color:"salmon"}},s.createElement("br",null),"Weave is currently in ",s.createElement("b",null,"open alpha"),", and contains a number of awful, awful bugs..."))),s.createElement(u,{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",color:"#000",fontSize:"1rem",padding:"0 0 0.25rem 0",borderTop:"1px solid #000"},buttons:s.createElement("span",{style:f.header},"Topics")},p.map(this.renderButton)),s.createElement(u,{style:{display:"flex",flexDirection:"column",alignItems:"stretch",color:"#000",fontSize:"1rem",padding:"0 0 0.25rem 0",borderTop:"1px solid #000"},buttons:s.createElement("span",{style:f.header},"Contact Us")},s.createElement("div",{style:f.box},"How to contact us...")),s.createElement(u,{style:{display:"flex",flexDirection:"column",alignItems:"stretch",color:"#000",fontSize:"1rem",padding:"0 0 0.25rem 0",borderTop:"1px solid #000"},buttons:s.createElement("span",{style:f.header},"Report A Bug")},s.createElement("div",{style:f.box},"How to report a bug...")),t.modal?s.createElement(l,{dismiss:function(){return o.setState({modal:void 0})},innerStyle:f.modal},this.renderModal(t.modal)):"")}},{key:"renderModal",value:function(e){var t=this;switch(e){case"Scenes":case"Notebar":case"User Interface":return[s.createElement("div",{style:f.title},e),s.createElement("section",{style:f.body},s.createElement("img",{style:f.img,src:"/dist/img/help/"+e+".gif"}),h[e].map(function(e,t){return s.createElement("p",{style:{marginTop:"0.5rem"}},e)}))];case"Plot Sidebar":case"Places":case"Threads":case"Search":return[s.createElement("div",{style:f.title},"Plot Sidebar"),"Plot Sidebar"!==e?s.createElement("div",{style:f.subtitle},e):"",s.createElement("section",{style:f.body},s.createElement("img",{style:f.img,src:"/dist/img/help/Plot Sidebar.gif"}),h[e].map(function(e,t){return s.createElement("p",{style:{marginTop:"0.5rem"}},e)})),s.createElement("div",{style:{width:"100%",marginTop:"1rem",display:"flex",justifyContent:"flex-end"}},["Plot Sidebar","Places","Threads","Search"].map(function(n){return s.createElement("span",{style:e===n?f.current:f.page,onmouseenter:function(t){return t.target.style.backgroundColor=e===n?"#444":"#999"},onmouseleave:function(t){return t.target.style.backgroundColor=e===n?"#444":"#ccc"},onclick:function(){return t.setState({modal:n})}}," ")}))];case"Book Sidebar":case"Chapters":case"Printing":return[s.createElement("div",{style:f.title},"Book Sidebar"),s.createElement("div",{style:f.subtitle},"Book Sidebar"!==e?e:""),s.createElement("section",{style:f.body},s.createElement("img",{style:f.img,src:"/dist/img/help/Book Sidebar.gif"}),h[e].map(function(e,t){return s.createElement("p",{style:{marginTop:"0.5rem"}},e)})),s.createElement("div",{style:{width:"100%",marginTop:"1rem",display:"flex",justifyContent:"flex-end"}},["Book Sidebar","Chapters","Printing"].map(function(n){return s.createElement("span",{style:e===n?f.current:f.page,onmouseenter:function(t){return t.target.style.backgroundColor=e===n?"#444":"#999"},onmouseleave:function(t){return t.target.style.backgroundColor=e===n?"#444":"#ccc"},onclick:function(){return t.setState({modal:n})}}," ")}))]}}}]),t}(s.Component);t.exports=m},{"../bind.js":8,"../buttons.js":9,"../colors.js":10,"./DragList.js":12,"./Draggable.js":14,"./DropZone.js":15,"./ImmutableInput.js":18,"./ModalView.js":20,"./ScrollingView.js":26,"./SidebarItem.js":27,preact:3}],18:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.state={allowUpdate:!0},c(i),i}return i(t,e),a(t,[{key:"shouldComponentUpdate",value:function(){return this.state.allowUpdate}},{key:"render",value:function(e,t,n){return s.createElement("input",{id:e.id,style:e.style,type:"text",size:e.size,maxLength:e.maxLength,placeholder:e.placeholder,value:e.value,ondblclick:e.ondblclick,onclick:e.onclick,oninput:e.oninput,onchange:this.onChange,onfocus:this.onFocus,onblur:this.onBlur,onkeyup:function(e){return 13===e.keyCode?e.currentTarget.blur():void 0}})}},{key:"onChange",value:function(e){this.setState({allowUpdate:!0}),this.props.onchange&&this.props.onchange(e)}},{key:"onFocus",value:function(e){this.setState({allowUpdate:!1}),this.props.onfocus&&this.props.onfocus(e)}},{key:"onBlur",value:function(e){this.setState({allowUpdate:!0}),this.props.onblur&&this.props.onblur(e)}}]),t}(s.Component);t.exports=l},{"../bind.js":8,preact:3}],19:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l=e("./DropZone.js"),u=e("./SceneEditor.js"),d=e("../buttons.js"),f=(e("./SceneWriter.js"),e("./DateTimeInput.js")),p=(e("../time.js"),{location:{position:"relative",display:"flex",flexGrow:"0",flexShrink:"0",flexDirection:"column",alignItems:"center",height:"auto",width:"20rem",marginRight:"0.5rem",transition:"width 0.5s ease-in"},header:{zIndex:20,color:"#eee",fontWeight:"100",display:"flex",fontSize:"1.25rem",justifyContent:"space-between",alignItems:"center",position:"absolute",backgroundColor:"inherit",width:"18rem",minheight:"1.5rem",padding:"0.5rem 1rem"},time:{outline:"none",border:"none",color:"#000",backgroundColor:"#fff",padding:"0.25rem 0.5rem",borderRadius:"0.25rem",fontSize:"0.9rem"}}),h=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.state={newScene:!1},c(i),i}return i(t,e),a(t,[{key:"render",value:function(e,t,n){var o=this;return s.createElement(l,{key:e.location.id,type:"scene",style:Object.assign({},p.location,{backgroundColor:e.location.color,height:Math.max(12.8*(e.height+11),window.innerHeight)+"px"},e.style),onDrop:e.onDrop},s.createElement("span",{style:Object.assign({left:"0px",top:e.offset+"px",display:"flex",justifyContent:"space-between"},p.header)},t.newScene?s.createElement(f,{ref:function(t){t&&"loc"+e.location.id===n.focus&&(t.base.children[0].focus(),n.eatFocus())},location:e.location.id,style:p.time,onchange:function(t){o.setState({newScene:!1}),n.Do("CreateScene",{location:e.location.id,time:t.target.value})},onblur:function(e){o.setState({newScene:!1})}}):[s.createElement(d,{img:"add",color:"#fff",style:p.button,onclick:function(){n.focusOn("loc"+e.location.id),o.setState({newScene:!0})}}),s.createElement("span",{style:{maxWidth:"15rem",textAlign:"right"}},e.location.name)]),e.scenes.map(function(t,n){return s.createElement(u,{style:{position:"absolute",top:e.times[t.utctime]+"rem"},scene:t,onWriteModal:e.onWriteModal})}))}}]),t}(s.Component);t.exports=h},{"../bind.js":8,"../buttons.js":9,"../time.js":32,"./DateTimeInput.js":11,"./DropZone.js":15,"./SceneEditor.js":24,"./SceneWriter.js":25,preact:3}],20:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c={outer:{zIndex:15,position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0,0,0,0.6)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",overflow:"scroll"},inner:{display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"center",maxHeight:"100vh",padding:"1.5rem",marginTop:"1rem",overflow:"scroll"}},l=function(e){function t(e,n){return o(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return i(t,e),a(t,[{key:"render",value:function(e,t){return s.createElement("div",{style:c.outer,onClick:e.dismiss},s.createElement("div",{style:Object.assign({},c.inner,e.innerStyle||{}),onClick:function(e){return e.stopPropagation()}},e.children))}}]),t}(s.Component);t.exports=l},{preact:3}],21:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l=(e("../colors.js"),e("./DropZone.js")),u=e("./SidebarItem.js"),d=e("./ExpandingTextarea.js"),f=e("./ScrollingView.js"),p=e("../buttons.js"),h={text:{width:"100%",border:"none",outline:"none",backgroundColor:"#eee",fontSize:"1.1rem",color:"#000"},tags:{color:"#666",fontSize:"0.8rem",marginBottom:"0.5rem",display:"flex"},note:{position:"relative",display:"flex",padding:"0.5rem",flexDirection:"column",justifyContent:"flex-start",alignItems:"stretch",fontSize:"1.2rem",margin:"0.25rem 0.25rem",backgroundColor:"#eee",borderRadius:"0.15rem"},hide:{cursor:"pointer",marginRight:"1rem",width:"1rem",height:"1rem"},list:{flexDirection:"column",padding:"0 0.3rem"},item:{margin:"0 0.5rem 0 0.5rem",width:"1rem",height:"1rem",border:"none",outline:"none",backgroundColor:"inherit",color:"#fff",fontSize:"1.2rem",cursor:"pointer",lineHeight:"1rem"},row:{display:"flex",justifyContent:"flex-start",alignItems:"center",color:"#fff",fontSize:"0.8rem"},delete:{position:"absolute",top:"0.5rem",right:"0.5rem",width:"1rem",height:"1rem",cursor:"pointer",backgroundColor:"inherit"},tooltip:{zIndex:100,position:"absolute",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",top:"-0.25rem",left:"1rem",color:"#fff",whiteSpace:"nowrap"},sidebar:{zIndex:49,position:"fixed",width:"27.75rem",top:0,bottom:0,transition:"right 0.3s ease-in-out"},spacer:{height:"100vh",transition:"width 0.3s ease-in-out"}},m=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.state={hover:-1},c(i),i}return i(t,e),a(t,[{key:"render",value:function(e,t,n){var o=this;return s.createElement("div",null,s.createElement("div",{style:Object.assign({width:e.toggled?"28.1rem":0},h.spacer)}," "),s.createElement(u,{style:Object.assign({right:e.toggled?0:"-28.5rem"},h.sidebar),buttons:[s.createElement(p,{img:"add",color:"#444",hoverColor:"#000",onclick:function(e){o.context.Do("CreateNote")},style:h.item}),s.createElement(p,{img:"note",color:"#000",noOpacity:!0,style:h.item,text:"Notes"})]},s.createElement(f,{style:{width:"100%",flexGrow:1,minHeight:"1rem"}},e.notes.map(function(e,r){return s.createElement(l,{key:e.id,type:["Thread","Location"],style:h.note,onMouseEnter:function(){return o.setState({hover:r})},onMouseLeave:function(){return o.setState({hover:-1})},onDrop:function(t){var o=t.id,r={id:e.id,tag:{}};r.tag[o]=!0,n.Do("ModifyNote",r)}},s.createElement("div",{style:h.tags},Object.keys(e.tag).map(function(t){var r=n.Get(t),i=r.color;return s.createElement("div",{style:"position: relative; border-radius: 1rem; background-color: rgba(0,0,0,0);",class:"tooltip"},s.createElement(p,{noOpacity:!0,img:"delete",color:i,style:Object.assign({},h.item,{backgroundColor:i,margin:"0 0.25rem 0 0",borderRadius:"0.5rem"}),onclick:function(e){o.timer&&(clearTimeout(o.timer),o.timer=void 0)},onmouseenter:function(e){return e.target.firstChild.style.backgroundColor="rgba(0,0,0,0)"},onmouseleave:function(e){return e.target.firstChild.style.backgroundColor=i},onmousedown:function(){var r={id:e.id,tag:{}};r.tag[t]=void 0,o.timer=setTimeout(n.Do,1e3,"ModifyNote",r)}}),s.createElement("div",{class:"tooltipText",style:Object.assign({backgroundColor:i},h.tooltip)},r.name))})),s.createElement(d,{style:h.text,oninput:function(t){return n.Do("ModifyNote",{id:e.id,body:t.target.value})},baseHeight:"1rem",placeholder:"Note",value:e.body,ref:function(e){return o.el=e}}),t.hover===r?s.createElement(p,{img:"delete",color:"#000",hoverColor:"#c30",style:h.delete,onclick:function(e){o.timer&&(clearTimeout(o.timer),o.timer=void 0)},onmousedown:function(t){o.timer=setTimeout(n.Do,1e3,"DeleteNote",e.id)}}):"")}))))}}]),t}(s.Component);t.exports=m},{"../bind.js":8,"../buttons.js":9,"../colors.js":10,"./DropZone.js":15,"./ExpandingTextarea.js":16,"./ScrollingView.js":26,"./SidebarItem.js":27,preact:3}],22:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){
for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l=(e("../colors.js"),e("./SidebarItem.js")),u=e("./DragList.js"),d=e("./ScrollingView.js"),f=e("../buttons.js"),p=(e("./Draggable.js"),e("./DropZone.js")),h=e("./ImmutableInput.js"),m={text:{flexGrow:1,width:"8.75rem",padding:"0.3rem 0.5rem 0.3rem 0",border:"none",outline:"none",backgroundColor:"rgba(0,0,0,0)",fontSize:"0.9rem",color:"#fff",textShadow:"0 0 0.25rem #111"},scene:{display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"#fff",color:"#000",fontSize:"0.9rem",padding:"0.25rem 0.5rem",margin:"2px 0 0 1rem",borderRadius:"0.15rem"},thread:{display:"flex",justifyContent:"space-between",alignItems:"center",fontSize:"0.9rem",padding:"0.25rem 0.5rem",margin:"0",borderRadius:"0.15rem"},hide:{cursor:"pointer",marginRight:"1rem",width:"1rem",height:"1rem"},delete:{cursor:"pointer",marginRight:"0.5rem",width:"1rem",height:"0.9rem"},list:{flexDirection:"column",padding:"0 0.25rem"},item:{margin:"0 0.25rem",width:"1rem",height:"1rem",border:"none",outline:"none",backgroundColor:"inherit",color:"#fff",fontSize:"1.2rem",cursor:"pointer",lineHeight:"1rem"},button:{fontSize:"1rem",fontStyle:"bold",color:"#000",border:"none",outline:"none",backgroundColor:"rgba(255, 255, 255, 0.5)",cursor:"pointer",borderRadius:"0.15rem",padding:"0.25rem 0.5rem"},row:{display:"flex",justifyContent:"flex-start",alignItems:"center",color:"#fff",fontSize:"0.8rem"}},y=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.state={hover:-1},i.focus=!1,c(i),i}return i(t,e),a(t,[{key:"render",value:function(e,t,n){var o=this;return s.createElement("div",{style:{flexShrink:"0",flexGrow:1,height:"60vh",display:"flex",flexDirection:"column"}},s.createElement(l,{style:{flexGrow:1,borderTop:"1px solid #000"},buttons:[s.createElement("span",{style:{fontSize:"0.9rem",color:"#000",fontWeight:"bold"}},"Chapters"),s.createElement(f,{img:"add",color:"#444",hoverColor:"#000",style:m.item,onclick:function(t){var o=e.chapters;o.unshift({title:"",scenes:[]}),n.Do("ModifyChapters",o)}})]},s.createElement(d,{style:{flexGrow:1,width:"100%",minHeight:"1rem"}},s.createElement(u,{style:m.list,type:"Chapter",items:e.chapters,onMove:this.moveChapter,item:function(e,t){var r=e.scenes.map(function(e){return n.Get(e)});return s.createElement(o.renderFolder,{chapter:e,scenes:r,wc:r.reduce(function(e,t){return e+t.wc},0),index:t})}}))),s.createElement("div",{style:{flexShrink:"0",color:"#000",fontSize:"1rem",margin:"0 0.5rem 0.15rem 0.5rem",display:"flex",flexDirection:"column",alignItems:"center",borderTop:"1px solid #000"}},s.createElement("div",null,s.createElement("div",{style:{marginTop:"0.25rem"}},s.createElement("input",{type:"checkbox",id:"printBody",value:"Body",checked:e.settings.body,onClick:function(e){n.Do("ModifyPrintSettings",{body:e.target.checked})}}),s.createElement("label",{for:"printBody",style:{marginLeft:"0.5rem"}},"Include Scene Body")),s.createElement("div",{style:{marginTop:"0.25rem"}},s.createElement("input",{type:"checkbox",id:"printSummary",value:"Summary",checked:e.settings.summary,onClick:function(e){return n.Do("ModifyPrintSettings",{summary:e.target.checked})}}),s.createElement("label",{for:"printSummary",style:{marginLeft:"0.5rem"}},"Include Scene Summary")),s.createElement("div",{style:{marginTop:"0.25rem"}},s.createElement("input",{type:"checkbox",id:"printDate",value:"Date",checked:e.settings.date,onClick:function(e){return n.Do("ModifyPrintSettings",{date:e.target.checked})}}),s.createElement("label",{for:"printDate",style:{marginLeft:"0.5rem"}},"Include Scene Date")),s.createElement("div",{style:{marginTop:"0.25rem"}},s.createElement("input",{type:"checkbox",id:"printThreads",value:"Threads",checked:e.settings.threads,onClick:function(e){return n.Do("ModifyPrintSettings",{threads:e.target.checked})}}),s.createElement("label",{for:"printThreads",style:{marginLeft:"0.5rem"}},"Include Scene Threads")),s.createElement("div",{style:{marginTop:"0.25rem"}},s.createElement("input",{type:"checkbox",id:"printLocation",value:"Location",checked:e.settings.location,onClick:function(e){return n.Do("ModifyPrintSettings",{location:e.target.checked})}}),s.createElement("label",{for:"printLocation",style:{marginLeft:"0.5rem"}},"Include Scene Location")),s.createElement("div",{style:{margin:"0.75rem 0 0.5rem 0",float:"right"}},s.createElement("span",{style:m.button,onclick:e.print,onmouseover:function(e){return e.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.8)"},onmouseleave:function(e){return e.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.5)"},onmousedown:function(e){return e.currentTarget.style.backgroundColor="#fff"}},"print")))))}},{key:"renderItem",value:function(e,t){var n=this;return s.createElement("div",{style:m.scene,onmouseover:function(t){return n.onHover(e.item.id)},onmouseleave:function(e){return n.onHover(-1)}},s.createElement("span",null,""!==e.item.summary?e.item.summary:"&nbsp;"),s.createElement("div",{style:{width:"1rem"}},this.state.hover===e.item.id?s.createElement(f,{noOpacity:!0,img:"delete",color:"#000",hoverColor:"#f00",style:m.delete,onclick:function(e){n.timer&&(clearTimeout(n.timer),n.timer=void 0)},onmousedown:function(t){n.timer=setTimeout(n.DeleteChapter,1e3,e.chapter,e.index)}}):""))}},{key:"DeleteChapter",value:function(e,t){var n=this.props.chapters;n[e].scenes.splice(t,1),this.context.Do("ModifyChapters",n)}},{key:"renderFolder",value:function(e,t){var n=this;return s.createElement("div",{style:{marginTop:"1px"}},s.createElement(p,{style:Object.assign({backgroundColor:"#666"},m.thread,{padding:"0 0.25rem 0 0"}),type:"scene",effect:"move",onMouseEnter:function(t){return n.setState({hover:e.index})},onMouseLeave:function(e){return n.setState({hover:-1})},onDrop:function(t){return n.onMove(t,{chapter:e.index,index:0})}},s.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"15.25rem"}},s.createElement("span",{style:{margin:"0 0.5rem"}},e.index+1),s.createElement(h,{placeholder:"Title",maxLength:"30",value:e.chapter.title,class:"noselect",type:"text",style:m.text,onmouseover:function(e){return e.target.readOnly=!0},onclick:function(e){e.target.focus()},onfocus:function(e){e.target.readOnly=!1,e.target.class=""},onchange:function(o){var r=n.props.chapters;r[e.index].title=o.target.value,t.Do("ModifyChapters",r)},onblur:function(e){e.target.readOnly=!0,e.target.class="noselect"}}),s.createElement("span",{style:{fontSize:"0.8rem"}},e.wc+" words")),s.createElement("div",{style:{width:"1rem"}},this.state.hover===e.index?s.createElement(f,{img:"delete",color:"#000",hoverColor:"#f00",style:m.delete,onclick:function(e){n.timer&&(clearTimeout(n.timer),n.timer=void 0)},onmousedown:function(o){var r=n.props.chapters;r.splice(e.index,1),t.Do("ModifyChapters",r)}}):"")),e.chapter.scenes.length?s.createElement(u,{style:Object.assign({},m.list,{padding:"0"}),type:"scene",items:e.scenes,onMove:this.onMove,payload:{chapter:e.index},item:function(t,o){return s.createElement(n.renderItem,{item:t,index:o,chapter:e.index})}}):s.createElement("div",null," "))}},{key:"onHover",value:function(e){this.setState({hover:e})}},{key:"onMove",value:function(e,t){var n=this.props.chapters;"string"==typeof e?n[t.chapter].scenes.indexOf(e)===-1&&n[t.chapter].scenes.unshift(e):n[t.chapter].scenes.unshift(n[e.chapter].scenes.splice(e.index,1)[0]),this.context.Do("ModifyChapters",n)}},{key:"moveChapter",value:function(e,t){var n=this.props.chapters;n.splice(t.index,0,n.splice(e.index,1)[0]),this.context.Do("ModifyChapters",n)}},{key:"componentDidUpdate",value:function(){this.focus&&this.index0&&(this.focus=!1,this.index0.focus())}}]),t}(s.Component);t.exports=y},{"../bind.js":8,"../buttons.js":9,"../colors.js":10,"./DragList.js":12,"./Draggable.js":14,"./DropZone.js":15,"./ImmutableInput.js":18,"./ScrollingView.js":26,"./SidebarItem.js":27,preact:3}],23:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l=e("./DragListWithFolders.js"),u=e("./TabbedSidebar.js"),d=(e("../buttons.js"),e("./PrintView.js")),f=e("./HelpView.js"),p=e("./ImmutableInput.js"),h={sidebar:{zIndex:50,position:"fixed",top:0,bottom:0,display:"flex",flexDirection:"column",justifyContent:"stretch",backgroundColor:"#999",transition:"left 0.3s ease-in-out, width 0.3s ease-in-out"},text:{padding:"0.3rem 0.5rem",border:"none",outline:"none",color:"#000",margin:"0.5rem",borderRadius:"0.15rem",fontSize:"1rem",fontWeight:"bold"},toolbar:{flexShrink:"0",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"stretch",padding:"0.25rem 0.5rem 0 0.5rem"},scene:{display:"flex",justifyContent:"space-around",alignItems:"center",padding:"0.25rem",marginTop:"0.5rem"},item:{margin:"0 0.8rem 0 0.8rem",border:"none",outline:"none",backgroundColor:"inherit",color:"#fff",width:"1rem",height:"1rem",cursor:"pointer"},row:{display:"flex",justifyContent:"flex-start",alignItems:"center",color:"#fff",fontSize:"0.8rem",height:"2rem"},issues:{display:"flex",justifyContent:"space-around",alignItems:"center",margin:"0 0 0.25rem 0",fontSize:"0.8rem",color:"#000"},searchBar:{height:"1.75rem",display:"flex",alignItems:"center",padding:"0.15rem 0.4rem 0.4rem 0.4rem"},search:{flexGrow:1,padding:"0.25rem 0.5rem",border:"none",outline:"none",textAlign:"center",fontSize:"1rem",borderRadius:"0.25rem"},button:{width:"5rem",height:"1.75rem",padding:"0.25rem",border:"none",outline:"none",backgroundColor:"#333",borderRadius:"0.25rem",color:"#fff",fontSize:"1rem",cursor:"pointer"},spacer:{height:"100vh",transition:"width 0.3s ease-in-out"}},m=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.state={width:"20rem",hidden:"-20.5rem"},c(i),i}return i(t,e),a(t,[{key:"render",value:function(e,t,n){return s.createElement("div",null,s.createElement("div",{style:Object.assign({width:e.toggled?t.width:0},h.spacer)}," "),s.createElement("div",{style:Object.assign({left:e.toggled?0:t.hidden},h.sidebar,{width:t.width})},s.createElement(u,{style:{borderTop:"none"},tab:e.tab,buttons:["help","print","craft"],text:["Help","Book","Plot"],onTab:this.onTab,tabs:[s.createElement(f,null),s.createElement("div",{style:{flexShrink:"0",flexGrow:1,height:"96vh",display:"flex",flexDirection:"column"}},s.createElement(p,{placeholder:"Book Title",maxLength:"64",value:e.project.meta.title,class:"noselect",type:"text",style:h.text,onmouseover:function(e){return e.target.readOnly=!0},onclick:function(e){e.target.focus()},onfocus:function(e){e.target.readOnly=!1,e.target.class=""},onchange:function(e){return n.Do("ModifyMeta",{title:e.target.value})},onblur:function(e){e.target.readOnly=!0,e.target.class="noselect"}}),s.createElement(p,{placeholder:"Author",maxLength:"30",value:e.project.meta.author,class:"noselect",type:"text",style:h.text,onmouseover:function(e){return e.target.readOnly=!0},onclick:function(e){e.target.focus()},onfocus:function(e){e.target.readOnly=!1,e.target.class=""},onchange:function(e){return n.Do("ModifyMeta",{author:e.target.value})},onblur:function(e){e.target.readOnly=!0,e.target.class="noselect"}}),s.createElement(d,{chapters:e.project.chapters,settings:e.project.printSettings,print:e.print})),[s.createElement("div",{style:h.toolbar},s.createElement("div",{style:h.searchBar},s.createElement(p,{id:"searchBar",style:h.search,placeholder:"Search",maxLength:"80",size:"24",oninput:function(e){return n.Do("ModifySearch",e.target.value)},value:e.project.search})),s.createElement("div",{style:h.issues},s.createElement("span",{class:"noselect"},e.scenes+" scenes"),s.createElement("span",{class:"noselect"},e.notes+" notes"))),s.createElement(l,{key:"threads",type:"Thread",btnColor:"#fff",visible:e.project.visible,free:e.project.threadList,folders:e.project.threadFolders}),s.createElement(l,{key:"locations",type:"Location",btnColor:"#fff",visible:e.project.visible,free:e.project.locationList,folders:e.project.locationFolders})]]})))}},{key:"onTab",value:function(e){var t=20;switch(this.props.onTab(e),e){case 0:t=20;break;case 1:t=20}this.setState({width:t+"rem",hidden:"-"+(t+.5)+"rem"})}}]),t}(s.Component);t.exports=m},{"../bind.js":8,"../buttons.js":9,"./DragListWithFolders.js":13,"./HelpView.js":17,"./ImmutableInput.js":18,"./PrintView.js":22,"./TabbedSidebar.js":28,preact:3}],24:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../buttons.js"),l=e("./Draggable.js"),u=e("../bind.js"),d=e("./ExpandingTextarea.js"),f=e("./DropZone.js"),p=e("./DateTimeInput.js"),h=document.getElementById("pin"),m={box:{padding:"0.5rem 1rem",color:"#222",display:"flex",flexDirection:"column",justifyContent:"space-around",alignItems:"stretch",width:"16rem",position:"relative",marginTop:"0.5rem",border:"1px solid rgba(0,0,0,0.5)",borderLeft:"none",borderRight:"none",boxShadow:"0 0.15rem 0.15rem rgba(0,0,0,0.5)",borderRadius:"0.15rem"},sceneHead:{fontSize:"1.1rem",height:"1.3rem",margin:"0.25rem 0.75rem"},stats:{flexShrink:0,color:"#000",display:"flex",justifyContent:"space-around",alignItems:"center",fontSize:"0.9rem",height:"1.25rem",marginBottom:"0.25rem"},wordcount:{fontSize:"0.9rem",padding:"0.5rem"},btn:{cursor:"pointer",width:"1rem",height:"1rem"},textarea:{fontSize:"1.1rem",maxHeight:"9rem",backgroundColor:"inherit"},time:{outline:"none",border:"none",backgroundColor:"inherit",width:"10rem",textAlign:"center"},threads:{flexShrink:0,height:"0.1rem"},tooltip:{zIndex:100,position:"absolute",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",top:"-0.25rem",left:"1rem",color:"#fff",whiteSpace:"nowrap",fontSize:"0.8rem"}},y=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.state={hover:!1,focus:!1},u(i),i}return i(t,e),a(t,[{key:"render",value:function(e,t,n){var o=this;return s.createElement(f,{key:e.scene.id,style:e.style,type:["Thread","Pin"],effect:"move",onDrop:function(t,o){n.Do("ThreadScene",{scene:e.scene.id,thread:t.id}),o.stopPropagation()}},s.createElement(l,{key:e.scene.id,type:"scene",effect:"move",payload:e.scene.id,style:Object.assign({zIndex:t.focus?100:5,maxHeight:t.focus?"14rem":"4.5rem",backgroundColor:t.focus?"#fff":"#eee"},m.box),onMouseEnter:function(e){o.setState({hover:!0})},onMouseLeave:function(e){o.setState({hover:!1})}},s.createElement("div",{style:m.threads},Object.keys(e.scene.thread).map(function(t,o){var r=n.Get(t);return s.createElement(l,{type:"Pin",effect:"move",payload:{id:t},style:{position:"absolute",left:1.5*o+1+"rem",top:"-0.4rem",borderRadius:"0.5rem",width:"1rem",height:"1rem",backgroundColor:r.color,overflow:"visible"},class:"tooltip",onDragStart:function(e){h.style.backgroundColor=r.color,e.dataTransfer.setDragImage(h,7,8)},onDragEnd:function(o){"none"===o.dataTransfer.dropEffect&&n.Do("UnthreadScene",{scene:e.scene.id,thread:t})}}," ",s.createElement("span",{class:"tooltipText",style:Object.assign({backgroundColor:r.color},m.tooltip)},r.name))})),s.createElement("div",{style:{display:"flex"}},s.createElement("div",{style:{flexGrow:"1",overflow:"hidden"}},s.createElement("span",{style:Object.assign({},m.stats,{justifyContent:"center"})},s.createElement(p,{location:e.scene.location,scene:e.scene.id,style:m.time,type:"text",maxLength:24,placeholder:"Date & Time",value:e.scene.time,onchange:function(t){return n.Do("ModifyScene",{id:e.scene.id,time:t.target.value})},onfocus:function(){return o.setState({focus:!0})},onblur:function(){return o.setState({focus:!1})}})),s.createElement(d,{ref:function(t){t&&e.scene.id===n.focus&&(t.base.focus(),n.eatFocus())},style:m.textarea,maxLength:250,oninput:this.onInput,baseHeight:"1.3rem",placeholder:"Summary",value:e.scene.summary,onfocus:function(){return o.setState({focus:!0})},onblur:function(){return o.setState({focus:!1})},ondragstart:this.preventDrag})),s.createElement("div",{style:{marginTop:"0.25rem",width:"1rem",height:"2.75rem",display:"flex",flexDirection:"column",justifyContent:"space-between"}},t.hover?[s.createElement(c,{img:"delete",color:"#000",hoverColor:"#c30",style:m.btn,onclick:function(e){o.timer&&(clearTimeout(o.timer),o.timer=void 0)},onmousedown:function(t){o.timer=setTimeout(n.Do,1e3,"DeleteScene",e.scene.id)}}),s.createElement(c,{img:"document",color:"#000",hoverColor:"#093",style:m.btn,onclick:function(){return e.onWriteModal(e.scene.id)}})]:""))))}},{key:"onInput",value:function(e){this.context.Do("ModifyScene",{id:this.props.scene.id,summary:e.target.value})}},{key:"preventDrag",value:function(e){e.preventDefault()}}]),t}(s.Component);t.exports=y},{"../bind.js":8,"../buttons.js":9,"./DateTimeInput.js":11,"./Draggable.js":14,"./DropZone.js":15,"./ExpandingTextarea.js":16,preact:3}],25:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){var t=0;for(f.lastIndex=0;f.test(e);)t++;return t}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=e("preact"),l=e("./ExpandingTextarea.js"),u=e("../bind.js"),d={box:{position:"relative",backgroundColor:"#fff",color:"#222",margin:"0 2rem",boxShadow:"0 0.15rem 0.5rem rgba(0,0,0,0.5)",borderRadius:"0.15rem",display:"flex",flexDirection:"column",alignItems:"stretch"},column:{position:"relative",width:"54rem",minHeight:"55rem",margin:"3rem auto 3rem auto",display:"flex",flexDirection:"column",alignItems:"stretch"},top:{padding:"0.5rem",display:"flex",justifyContent:"space-around",color:"#fff"},thread:{color:"#fff",fontSize:"0.75rem",height:"1rem",borderRadius:"1rem",marginBottom:"0.5rem",marginRight:"0.5rem",padding:"0.25rem 0.5rem 0.2rem 0.5rem"},sceneHead:{color:"inherit",fontSize:"1.5rem",margin:"2rem 2rem 1rem 2rem",backgroundColor:"inherit"},sceneBody:{color:"inherit",fontSize:"1.3rem",margin:"1rem 2rem 3rem 2rem",lineHeight:"130%",backgroundColor:"inherit"},stats:{color:"#fff",fontSize:"1.1rem",width:"51rem",margin:"0 auto",padding:"0.75rem 1.5rem 0.75rem 1.5rem",display:"flex",flexDirection:"row",justifyContent:"space-between",top:"0",position:"fixed"},doneButton:{fontSize:"1rem",fontStyle:"bold",border:"none",outline:"none",backgroundColor:"rgba(255, 255, 255, 0.5)",cursor:"pointer",borderRadius:"0.15rem",padding:"0 0.5rem",marginRight:"0.5rem"},modal:{zIndex:30,width:"100%",minHeight:"100vh"},threads:{position:"fixed",flexShrink:0,display:"flex",flexDirection:"column"},tooltip:{position:"relative",left:"0.7rem",top:"-0.25rem",padding:"0.25rem 0.5rem",borderRadius:"0.5rem",color:"#fff",whiteSpace:"nowrap",fontSize:"0.8rem"}},f=/[\w'’]+(?!\w*>)/gim,p=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.state={scene:Object.assign({},e.scene),pages:Math.round(e.scene.wc/275)||1,pageOf:1,statStyle:d.statFree},i.offset=0,u(i),i}return i(t,e),s(t,[{key:"render",value:function(e,t,n){var o=this,r=n.Get(e.scene.location);return c.createElement("div",{style:Object.assign({backgroundColor:r.color},d.modal)},c.createElement("div",{style:d.column},c.createElement("div",{style:d.box},c.createElement(l,{buffer:500,style:d.sceneHead,maxLength:"250",oninput:function(t){return o.context.Do("ModifyScene",{id:e.scene.id,summary:t.target.value})},value:e.scene.summary,baseHeight:"1.7em",placeholder:"Summary",ondragstart:function(e){return e.preventDefault()}}),c.createElement(l,{ref:function(e){return o.body=e?e.base:void 0},buffer:500,style:d.sceneBody,oninput:this.onBody,value:e.scene.body,baseHeight:"1.1em",placeholder:"Body",ondragstart:function(e){return e.preventDefault()}}),c.createElement("div",{style:Object.assign({transform:"translate(-"+Math.floor(n.fontSize/2)+"px,"+Math.ceil(n.fontSize/2)+"px)"},d.threads)},Object.keys(e.scene.thread).map(function(e,t){var o=n.Get(e);return c.createElement("div",{style:{borderRadius:"0.5rem",width:"1rem",height:"1rem",backgroundColor:o.color,overflow:"visible",margin:"0.25rem 0"},class:"tooltip"}," ",c.createElement("span",{class:"tooltipText",style:Object.assign({backgroundColor:o.color},d.tooltip)},o.name))}))),c.createElement("span",{style:Object.assign({backgroundColor:r.color},d.stats)},c.createElement("span",{style:{display:"flex",alignItems:"flex-end"}},c.createElement("span",{style:{fontSize:"1.25rem",marginLeft:"0.5rem"}},r.name),c.createElement("span",{style:{marginLeft:"2rem"}},e.scene.time)),c.createElement("span",{style:{display:"flex",alignItems:"flex-end"}},c.createElement("span",null,e.scene.wc+" words"),c.createElement("span",{style:{marginLeft:"2rem"}},t.pageOf+" / "+t.pages)),c.createElement("span",{style:Object.assign({color:r.color},d.doneButton),onclick:function(t){return e.dismiss()},onmouseover:function(e){return e.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.8)"},onmouseleave:function(e){return e.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.5)"},onmousedown:function(e){return e.currentTarget.style.backgroundColor="#fff"}},"done"))))}},{key:"componentDidMount",value:function(){window.document.body.addEventListener("scroll",this.onScroll),window.document.body.addEventListener("resize",this.onResize),window.document.body.scrollTo(0,0)}},{key:"componentWillUnmount",value:function(){window.document.body.removeEventListener("scroll",this.onScroll),window.document.body.removeEventListener("resize",this.onResize)}},{key:"onBody",value:function(e){var t=a(e.target.value);this.state.pages=Math.round(t/275)||1,this.onScroll(),this.context.Do("ModifyScene",{id:this.props.scene.id,body:e.target.value,wc:t}),e.preventDefault()}},{key:"onScroll",value:function(){this.pageCount(),this.offset=window.document.body.scrollTop}},{key:"pageCount",value:function(){var e;this.body.clientHeight>window.innerHeight?(e=Math.abs(this.body.getBoundingClientRect().top),e=e/this.body.clientHeight*(this.state.pages+1),(e=Math.ceil(e))>this.state.pages&&(e=this.state.pages)):e=1,e!==this.state.pageOf&&this.setState({pageOf:e})}}]),t}(c.Component);t.exports=p},{"../bind.js":8,"./ExpandingTextarea.js":16,preact:3}],26:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l={scrollWindow:{overflow:"scroll"}},u=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return c(i),i}return i(t,e),a(t,[{key:"render",value:function(e,t,n){return s.createElement("div",{style:Object.assign({},l.scrollWindow,e.style),onmouseover:function(){return document.body.style.overflow="hidden"},onmouseleave:function(){return document.body.style.overflow="scroll"}},e.children)}}]),t}(s.Component);t.exports=u},{"../bind.js":8,preact:3}],27:[function(e,t,n){"use strict";function o(e,t,n){return r.createElement("div",{style:Object.assign({},i.item,e.style||{})},r.createElement("div",{style:i.row},e.buttons),e.children)}var r=e("preact"),i=(e("../bind.js"),{item:{color:"#fff",display:"flex",flexDirection:"column",justifyContent:"flex-start",alignItems:"stretch",backgroundColor:"#999",padding:"0.25rem"},row:{marginBottom:"0.25rem",padding:"0 0.55rem",display:"flex",justifyContent:"space-between",alignItems:"center",height:"1.75rem",flexShrink:"0"}});t.exports=o},{"../bind.js":8,preact:3}],28:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l=e("../buttons.js"),u={item:{color:"#fff",display:"flex",flexDirection:"column",justifyContent:"stretch",alignItems:"stretch",borderTop:"1px solid #555",backgroundColor:"#999",padding:"0.25rem 0"},button:{border:"none",outline:"none",backgroundColor:"inherit",color:"#fff",width:"1.25rem",height:"1.25rem",cursor:"pointer"},row:{padding:"0 0.55rem",display:"flex",justifyContent:"space-around",alignItems:"center",height:"2rem",flexShrink:"0",borderBottom:"1px solid #333"},buttonText:{color:"#000",fontSize:"0.9rem",marginLeft:"0.5rem",fontWeight:"bold"}},d=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return c(i),i}return i(t,e),a(t,[{key:"render",value:function(e,t,n){return s.createElement("div",{style:Object.assign({},u.item,e.style||{})},s.createElement("div",{style:u.row},e.buttons.map(function(t,n){return s.createElement(l,{img:t,color:e.tab===n?"#000":"#444",hoverColor:"#000",style:u.button,noOpacity:e.tab===n,text:e.text[n],onclick:function(){return e.onTab(n)}})})),e.tabs[e.tab])}}]),t}(s.Component);t.exports=d},{"../bind.js":8,"../buttons.js":9,preact:3}],29:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l={svg:{position:"absolute",top:"0.25rem",left:"2.25rem",pointerEvents:"none"}},u=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return c(i),i}return i(t,e),a(t,[{key:"render",value:function(e,t,n){var o=this;return s.createElement("svg",{style:Object.assign({width:e.width-2.7+"rem",height:e.height+"rem"},l.svg),x:"0px",y:"0px",viewBox:"0 0 "+(e.width-2.7)+" "+e.height},Object.keys(e.threads).map(function(t){var r=n.Get(t);return s.createElement("g",null,e.threads[t].map(function(e){return o.renderSection(r,e)}))}))}},{key:"renderSection",value:function(e,t,n){var o=this;return s.createElement("path",{"stroke-dasharray":void 0!==n?"0.5 2.2":"normal"===t[0]?"1 0":"0.5 0.4",fill:"transparent","stroke-width":"0.3",stroke:n?n:e.color,d:t.reduce(function(e,n,r){var i,a,s,c,l,u,d;return"string"==typeof n?e:(u=20.5*n[0]+n[2],d=o.props.times[n[1]],1===r?e+"M"+(u+.25)+","+(d+.25):(s=t[r-1],i=20.5*s[0]+s[2],a=o.props.times[s[1]],c=i+(u-i)/2,l=a+(d-a)/2,Math.abs(u-i)<5?e+"L"+(u+.25)+","+(d+.25):e+"Q"+(i+.25)+" "+(l+.25+n[2])+","+(c+.25)+" "+(l+.25+n[2])+"Q"+(u+.25)+" "+(l+.25+n[2])+","+(u+.25)+" "+(d+.25)))},"")})}}]),t}(s.Component);t.exports=u},{"../bind.js":8,preact:3}],30:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=e("preact"),c=e("../bind.js"),l=e("./ThreadPaths.js"),u=e("./Location.js"),d=(e("./DropZone.js"),e("./SceneEditor.js"),e("../buttons.js"),e("./SceneWriter.js")),f={weave:{display:"flex",overflow:"scroll",flexGrow:1},scenes:{zIndex:5,position:"relative",display:"flex",justifyContent:"flex-start",alignItems:"flex-start"},location:{position:"relative",display:"flex",flexGrow:"0",flexShrink:"0",flexDirection:"column",alignItems:"center",height:"auto",width:"20rem",marginRight:"0.5rem"},header:{zIndex:20,color:"#fff",fontWeight:"400",
display:"flex",justifyContent:"space-between",alignItems:"center",position:"absolute",backgroundColor:"inherit",width:"18rem",height:"1rem",padding:"0.5rem 1rem",borderBottom:"1px solid #000"}},p=window.scrollX,h=window.scrollY,m=function(e){function t(e,n){o(this,t);var i=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return i.state={offsetX:p,offsetY:h,focusedScene:null},c(i),i}return i(t,e),a(t,[{key:"componentDidMount",value:function(){window.document.body.addEventListener("scroll",this.onScroll)}},{key:"componentWillUnmount",value:function(){window.document.body.removeEventListener("scroll",this.onScroll)}},{key:"render",value:function(e,t,n){var o=this,r=Object.keys(e.map.scenes);return t.focusedScene?s.createElement(d,{key:"scene-writer",scene:n.Get(t.focusedScene),dismiss:this.onDismissModal}):s.createElement("div",{key:"weave-view","data-is":"WeaveView",style:Object.assign(f.weave,{justifyContent:"flex-start"}),onclick:e.onDeselect},s.createElement("div",{style:{display:"flex",position:"relative",margin:"auto"}},r.map(function(i,a){return s.createElement(u,{style:{marginRight:r.length-1===a?"0":"0.5rem"},location:n.Get(i),scenes:e.map.scenes[i],times:e.map.times,height:e.map.offset,onDrop:function(e){return n.Do("ModifyScene",{id:e,location:i})},index:a,context:n,offset:t.offsetY,onWriteModal:o.onWriteModal})}),s.createElement(l,{thread:e.thread,threads:e.map.threads,times:e.map.times,width:20.5*Object.keys(e.map.scenes).length,height:e.map.offset})))}},{key:"onDismissModal",value:function(){this.setState({focusedScene:null},function(){return window.document.body.scrollTo(p,h)}),window.document.body.addEventListener("scroll",this.onScroll)}},{key:"onWriteModal",value:function(e){window.document.body.removeEventListener("scroll",this.onScroll),this.setState({focusedScene:e})}},{key:"onScroll",value:function(e){p=e.target.scrollLeft,h=e.target.scrollTop,this.setState({offsetX:p,offsetY:h})}}]),t}(s.Component);t.exports=m},{"../bind.js":8,"../buttons.js":9,"./DropZone.js":15,"./Location.js":19,"./SceneEditor.js":24,"./SceneWriter.js":25,"./ThreadPaths.js":29,preact:3}],31:[function(e,t,n){"use strict";"function"!=typeof Object.assign&&(Object.assign=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),o=1;o<arguments.length;o++){var r=arguments[o];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])}return n})},{}],32:[function(e,t,n){"use strict";var o="(?:[ ./\\-T](\\d\\d?)(?:\\W?[:./h\\-]\\W?(\\d\\d))?\\W?(pm|Pm|PM|pM)?)?",r=[["YYYY.MM(.DD) (HH(.MM))",new RegExp("(\\d{4})[./\\-](\\d\\d?)(?:[./\\-](\\d\\d?))?"+o,"i"),function(e){var t="";return t+=e[1],t+="-"+e[2],t+=e[3]?(1===e[3].length?"-0":"-")+e[3]:"-01",e[6]?t+=e[4]?"T"+Number(Number.parseInt(e[4],10)+12).toString():"T00":t+=e[4]?(1===e[4].length?"T0":"T")+e[4]:"T00",t+=e[5]?":"+e[5]:":00",t+=":00Z"}],["(DD.)MM.(YY)YY (HH(.MM))",new RegExp("(?:(\\d\\d?)[./\\-])?(\\d\\d?)[./\\-](\\d{2,4})"+o,"i"),function(e){var t="";return t+=2===e[3].length?"20"+e[3]:e[3],t+="-"+e[2],t+=e[1]?(1===e[1].length?"-0":"-")+e[1]:"-01",e[6]?t+=e[4]?"T"+Number(Number.parseInt(e[4],10)+12).toString():"T00":t+=e[4]?(1===e[4].length?"T0":"T")+e[4]:"T00",t+=e[5]?":"+e[5]:":00",t+=":00Z"}],["(SS)|(MMM.(DD)).YYYY (HH(.MM))",new RegExp("(?:(?:\\W*(Spring)|(Summer)|(Fall)|(Winter))|(?:(?:\\W*((?:Jan\\w*)|i)|((?:Feb\\w*)|ii)|((?:Mar\\w*)|iii)|((?:Apr\\w*)|iv)|((?:May\\w*)|v)|((?:Jun\\w*)|vi)|((?:Jul\\w*)|vii)|((?:Aug\\w*)|viii)|((?:Sep\\w*)|ix)|((?:Oct\\w*)|x)|((?:Nov\\w*)|xi)|((?:Dec\\w*)|xii)[.,]?)(?:\\W*(\\d\\d?)\\s?(?:st|nd|rd|th)?)?[,.]?))?(?:\\W*\\b(\\d{1,4})\\s*?(?:(AD|A\\.D\\.|CE|C\\.E\\.)|(BCE?|B\\.C\\.(?:E\\.)?))?)"+o,"i"),function(e){var t="";if(e[20]&&(t+="-"),t+=e[18]+"-",e[1])t+="04";else if(e[2])t+="07";else if(e[3])t+="10";else if(e[4])t+="01";else for(var n=5;n<17;n++){if(void 0!==e[n]){t+=(n<14?"0":"")+(n-4);break}16===n&&(t+="01")}return void 0!==e[17]?t+=(e[17]<10?"-0":"-")+e[17]:t+="-01",e[23]?t+=e[21]?"T"+Number(Number.parseInt(e[21],10)+12).toString():"T00":t+=e[21]?(1===e[21].length?"T0":"T")+e[21]:"T00",t+=e[22]?":"+e[22]:":00",t+=":00Z"}]];t.exports=function(e){for(var t,n={type:"",isValid:!1,ISOString:(new Date).toISOString()},o=0;o<r.length;o++)if(t=r[o][1].exec(e),Array.isArray(t))return n.type=r[o][0],n.ISOString=r[o][2](t),isNaN(Date.parse(n.ISOString))||(n.isValid=!0),n;return n}},{}]},{},[4]);
